<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>week12-problem-set</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="week12-problem-set_files/libs/clipboard/clipboard.min.js"></script>
<script src="week12-problem-set_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="week12-problem-set_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="week12-problem-set_files/libs/quarto-html/popper.min.js"></script>
<script src="week12-problem-set_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="week12-problem-set_files/libs/quarto-html/anchor.min.js"></script>
<link href="week12-problem-set_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="week12-problem-set_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="week12-problem-set_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="week12-problem-set_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="week12-problem-set_files/libs/bootstrap/bootstrap-bc29b7a494c55474c6a8d56f75b3cb06.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<hr>
<p>title: “Problem Set: Applying Logistic Regression &amp; Evaluating Classifiers” subtitle: “Python for Business Analytics” author: “Dr.&nbsp;Smith” institute: “University of South Florida” execute: echo: true warning: false format: html: embed-resources: true page-layout: full grid: body-width: 1400px sidebar-width: 250px margin-width: 0px gutter-width: 1.5rem toc: true toc-location: left toc-depth: 2 number-sections: false highlight-style: github code-fold: false code-tools: false code-block-bg: “#f5f5f5” code-block-border-left: “#31BAE9” code-block-line-numbers: false code-overflow: scroll code-link: false theme: light: flatly dark: darkly callout-appearance: simple self-contained: true code-line-numbers: true —</p>
<style>
/* Canvas iframe optimization */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
  font-size: 16px;
  line-height: 1.5;
  color: #212529;
}

@media screen {
  body.in-iframe {
    margin: 0;
    padding: 15px;
    max-width: 100%;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    font-size: 16px;
    line-height: 1.5;
    color: #212529;
  }
  .in-iframe .quarto-container {
    max-width: 100%;
    padding: 0 15px;
  }
  .in-iframe #quarto-content {
    max-width: 100%;
  }
  .in-iframe .page-layout-article {
    grid-template-columns: minmax(0, 1fr);
  }
  .in-iframe .page-layout-full {
    grid-template-columns: minmax(0, 1fr);
  }
  .in-iframe .sidebar {
    width: 200px !important;
    font-size: 0.9em;
  }
  .in-iframe .sidebar.toc-left {
    width: 200px !important;
    margin-right: 15px;
  }
  .in-iframe .column-body {
    grid-column: 1;
    max-width: 100%;
  }
  .in-iframe #quarto-document-content {
    max-width: calc(100% - 220px);
    padding: 0 15px;
  }
  .in-iframe pre {
    overflow-x: auto;
    max-width: 100%;
    font-size: 0.9em;
  }
  .in-iframe code {
    font-size: 0.9em;
  }
  .in-iframe table {
    display: block;
    overflow-x: auto;
    max-width: 100%;
    font-size: 0.9em;
  }
  .in-iframe img {
    max-width: 100%;
    height: auto;
  }
  .in-iframe .callout {
    margin: 1em 0;
    padding: 0.5em 1em;
  }
  .in-iframe .sourceCode {
    max-width: 100%;
    overflow-x: auto;
  }
  .in-iframe .cell {
    max-width: 100%;
  }
  .in-iframe body {
    font-size: 15px;
  }
  .in-iframe h1 {
    font-size: 1.8em;
  }
  .in-iframe h2 {
    font-size: 1.5em;
  }
  .in-iframe h3 {
    font-size: 1.3em;
  }
  .in-iframe h4 {
    font-size: 1.1em;
  }
  .in-iframe #quarto-margin-sidebar {
    display: none !important;
  }
  .in-iframe .margin-sidebar {
    display: none !important;
  }
  
  /* Ensure proper paragraph spacing */
  .in-iframe p {
    margin-bottom: 1rem;
  }
  
  /* Maintain list styling */
  .in-iframe ul, .in-iframe ol {
    margin-bottom: 1rem;
  }
}

@media screen and (max-width: 768px) {
  .in-iframe .sidebar {
    display: none !important;
  }
  .in-iframe #quarto-document-content {
    max-width: 100%;
  }
  .in-iframe body {
    font-size: 14px;
  }
}
</style>
<script>
if (window.self !== window.top) {
  document.addEventListener("DOMContentLoaded", function() {
    document.body.classList.add("in-iframe");
  });
}
</script>
<section id="problem-set-applying-logistic-regression-evaluating-classifiers" class="level2">
<h2 class="anchored" data-anchor-id="problem-set-applying-logistic-regression-evaluating-classifiers">Problem Set: Applying Logistic Regression &amp; Evaluating Classifiers</h2>
<p><strong>Instructions:</strong> Read each scenario carefully. Use the provided Python code to generate sample data. Then, answer the questions, focusing on applying logistic regression concepts and evaluating model performance using appropriate classification metrics. The solution section includes code demonstrations.</p>
<p><strong>Core Libraries:</strong> Make sure you have pandas, numpy, and scikit-learn installed. We will use train-test splitting for proper evaluation.</p>
<div id="setup" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, precision_score, recall_score, f1_score, classification_report</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a consistent random state for reproducibility in data generation AND splitting</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>GLOBAL_RANDOM_STATE <span class="op">=</span> <span class="dv">42</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Libraries imported and global random state set."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Libraries imported and global random state set.</code></pre>
</div>
</div>
<hr>
<p><strong>Question 1: E-commerce Website Conversion</strong></p>
<ul>
<li><strong>Scenario:</strong> An online retailer wants to understand what drives visitors to make a purchase on their website during a single session and evaluate how well their predictive model performs.</li>
<li><strong>Data Generation Code:</strong></li>
</ul>
<div id="generate-q1-data" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Generate Q1 Data ---</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(GLOBAL_RANDOM_STATE) <span class="co"># Use global state</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>n_sessions <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>time_on_site <span class="op">=</span> np.random.normal(<span class="dv">120</span>, <span class="dv">50</span>, n_sessions) <span class="co"># Avg 120s, std 50s</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>pages_viewed <span class="op">=</span> np.random.poisson(<span class="dv">5</span>, n_sessions) <span class="op">+</span> <span class="dv">1</span> <span class="co"># Avg 5 pages (+1 to avoid 0)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>came_from_ad <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">2</span>, n_sessions) <span class="co"># 0 or 1</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of purchase increases with time and pages</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume 'came_from_ad' slightly decreases probability (maybe less targeted traffic?)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span> <span class="op">+</span> <span class="fl">0.01</span> <span class="op">*</span> time_on_site <span class="op">+</span> <span class="fl">0.15</span> <span class="op">*</span> pages_viewed <span class="op">-</span> <span class="fl">0.2</span> <span class="op">*</span> came_from_ad</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>prob_purchase <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>z))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>made_purchase <span class="op">=</span> (prob_purchase <span class="op">&gt;</span> np.random.rand(n_sessions)).astype(<span class="bu">int</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure positive values for time/pages</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>time_on_site <span class="op">=</span> np.maximum(time_on_site, <span class="dv">10</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>pages_viewed <span class="op">=</span> np.maximum(pages_viewed, <span class="dv">1</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>df_q1 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TimeOnSite'</span>: time_on_site,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PagesViewed'</span>: pages_viewed,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CameFromAd'</span>: came_from_ad,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'MadePurchase'</span>: made_purchase</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--- Q1: E-commerce Conversion Data ---"</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Display basic info (optional uncomment)</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q1.head())</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nData Info:")</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q1.info())</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nPurchase Distribution:")</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q1['MadePurchase'].value_counts(normalize=True))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Q1: E-commerce Conversion Data ---</code></pre>
</div>
</div>
<ul>
<li><strong>Starter Code:</strong></li>
</ul>
<div id="starter-q1" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Starter code for Q1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume df_q1 is loaded from the generation code above</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Q1 Data Sample:"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_q1.head())</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Your exploration/modeling/evaluation code would start here ---</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Define features (X) and target (y)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>X1 <span class="op">=</span> df_q1[[<span class="st">'TimeOnSite'</span>, <span class="st">'PagesViewed'</span>, <span class="st">'CameFromAd'</span>]]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> df_q1[<span class="st">'MadePurchase'</span>]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Train/Test Split (Essential for Evaluation!)</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># X1_train, X1_test, y1_train, y1_test = train_test_split(</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     X1, y1, test_size=0.25, random_state=GLOBAL_RANDOM_STATE, stratify=y1</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Q1 Data Sample:
   TimeOnSite  PagesViewed  CameFromAd  MadePurchase
0  144.835708            7           0             0
1  113.086785            3           1             0
2  152.384427            5           0             0
3  196.151493            8           1             1
4  108.292331            7           0             0</code></pre>
</div>
</div>
<ul>
<li><strong>Questions:</strong>
<ul>
<li><ol type="a">
<li>Identify the dependent variable (Y) and the independent variables (X) for a logistic regression model.</li>
</ol></li>
<li><ol start="2" type="a">
<li>The retailer runs a logistic regression model on the <em>training</em> data and finds the coefficient for <code>PagesViewed</code> is 0.15. Calculate and interpret the odds ratio for <code>PagesViewed</code>.</li>
</ol></li>
<li><ol start="3" type="a">
<li>The model predicts the following probabilities of making a purchase for two different sessions: Session A: P(Purchase) = 0.65, Session B: P(Purchase) = 0.40. Using the default threshold of 0.5, what would the model predict for each session (Purchase or No Purchase)? How might the retailer use the <em>probabilities</em> differently than the binary predictions?</li>
</ol></li>
<li><ol start="4" type="a">
<li>After fitting the model on a training set and making predictions on a <strong>test set</strong>, the following confusion matrix is obtained for predicting <code>MadePurchase</code> (1 = Purchase, 0 = No Purchase):</li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 35%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Predicted: No Purchase (0)</th>
<th style="text-align: center;">Predicted: Purchase (1)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Actual: No Purchase (0)</strong></td>
<td style="text-align: center;">100 (TN)</td>
<td style="text-align: center;">10 (FP)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Actual: Purchase (1)</strong></td>
<td style="text-align: center;">20 (FN)</td>
<td style="text-align: center;">30 (TP)</td>
</tr>
</tbody>
</table>
Calculate the <strong>Accuracy, Precision, Recall, and F1-Score</strong> based on this matrix. Show your calculations.</li>
<li><ol start="5" type="a">
<li>In this e-commerce scenario, would the retailer likely be more concerned with low Precision or low Recall when predicting purchases? Explain your reasoning, considering potential business actions based on the prediction.</li>
</ol></li>
</ul></li>
</ul>
<hr>
<p><strong>Question 2: Loan Application Risk Assessment</strong></p>
<ul>
<li><strong>Scenario:</strong> A bank wants to predict the risk of default for personal loan applicants and rigorously evaluate its model’s effectiveness.</li>
<li><strong>Data Generation Code:</strong></li>
</ul>
<div id="generate-q2-data" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Generate Q2 Data ---</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(GLOBAL_RANDOM_STATE <span class="op">+</span> <span class="dv">1</span>) <span class="co"># Use global state + offset</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>n_applicants <span class="op">=</span> <span class="dv">600</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>credit_score <span class="op">=</span> np.random.randint(<span class="dv">550</span>, <span class="dv">800</span>, n_applicants)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>loan_amount <span class="op">=</span> np.random.normal(<span class="dv">15000</span>, <span class="dv">5000</span>, n_applicants)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>annual_income <span class="op">=</span> np.random.normal(<span class="dv">60000</span>, <span class="dv">15000</span>, n_applicants)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of default decreases with credit score and income, increases with loan amount</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="fl">5.0</span> <span class="op">-</span> <span class="fl">0.01</span> <span class="op">*</span> credit_score <span class="op">+</span> <span class="fl">0.00002</span> <span class="op">*</span> loan_amount <span class="op">-</span> <span class="fl">0.00003</span> <span class="op">*</span> annual_income</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>prob_default <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>z))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>loan_defaulted <span class="op">=</span> (prob_default <span class="op">&gt;</span> np.random.rand(n_applicants)).astype(<span class="bu">int</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure non-negative loan/income</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>loan_amount <span class="op">=</span> np.maximum(loan_amount, <span class="dv">1000</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>annual_income <span class="op">=</span> np.maximum(annual_income, <span class="dv">15000</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>df_q2 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CreditScore'</span>: credit_score,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LoanAmount'</span>: loan_amount,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AnnualIncome'</span>: annual_income,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LoanDefaulted'</span>: loan_defaulted</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--- Q2: Loan Default Data ---"</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display basic info (optional uncomment)</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q2.head())</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nData Info:")</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q2.info())</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nDefault Distribution:")</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q2['LoanDefaulted'].value_counts(normalize=True))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Q2: Loan Default Data ---</code></pre>
</div>
</div>
<ul>
<li><strong>Starter Code:</strong></li>
</ul>
<div id="starter-q2" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Starter code for Q2</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume df_q2 is loaded from the generation code above</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Q2 Data Sample:"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_q2.head())</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Your exploration/modeling/evaluation code would start here ---</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>X2 <span class="op">=</span> df_q2[[<span class="st">'CreditScore'</span>, <span class="st">'LoanAmount'</span>, <span class="st">'AnnualIncome'</span>]]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> df_q2[<span class="st">'LoanDefaulted'</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Train/Test Split</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># X2_train, X2_test, y2_train, y2_test = train_test_split(</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     X2, y2, test_size=0.25, random_state=GLOBAL_RANDOM_STATE, stratify=y2</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Q2 Data Sample:
   CreditScore    LoanAmount  AnnualIncome  LoanDefaulted
0          618  22414.041474  48623.794425              0
1          614  12787.133304  55581.189058              0
2          599  11815.513160  80121.212646              0
3          571  19934.726643  79696.870400              1
4          608  20241.352619  62186.336423              0</code></pre>
</div>
</div>
<ul>
<li><strong>Questions:</strong>
<ul>
<li><ol type="a">
<li>What is the primary goal of building a logistic regression model in this scenario? What is the dependent variable (Y)?</li>
</ol></li>
<li><ol start="2" type="a">
<li>A model trained on similar data shows an odds ratio of 0.98 for the <code>CreditScore</code> variable. How would you interpret this odds ratio in the context of loan defaults?</li>
</ol></li>
<li><ol start="3" type="a">
<li>The odds ratio for <code>LoanAmount</code> is 1.05. Interpret this odds ratio. Does this seem logical?</li>
</ol></li>
<li><ol start="4" type="a">
<li>Using the fitted model on a test set, the bank generates predictions. Explain what <strong>True Positives (TP), True Negatives (TN), False Positives (FP), and False Negatives (FN)</strong> represent in <em>this specific context</em> (loan default prediction, where 1 = Default, 0 = No Default).</li>
</ol></li>
<li><ol start="5" type="a">
<li>Why might <strong>Recall</strong> be a particularly important metric for the bank when evaluating this model? What is the potential consequence of having a low Recall?</li>
</ol></li>
</ul></li>
</ul>
<hr>
<p><strong>Question 3: Targeted Online Advertising</strong></p>
<ul>
<li><strong>Scenario:</strong> A digital marketing agency wants to predict whether a user will click on a specific online banner ad and evaluate the model’s effectiveness for campaign optimization.</li>
<li><strong>Data Generation Code:</strong></li>
</ul>
<div id="generate-q3-data" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Generate Q3 Data ---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(GLOBAL_RANDOM_STATE <span class="op">+</span> <span class="dv">2</span>) <span class="co"># Use global state + offset</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>n_impressions <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>user_age <span class="op">=</span> np.random.randint(<span class="dv">18</span>, <span class="dv">65</span>, n_impressions)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>time_of_day <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">24</span>, n_impressions) <span class="co"># Hour 0-23</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate website category impact (e.g., Shopping=higher prob, News=lower)</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>website_context_factor <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, n_impressions) <span class="co"># Proxy for category/relevance</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of click might decrease slightly with age, vary by time, depend on context</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="op">-</span><span class="fl">4.5</span> <span class="op">-</span> <span class="fl">0.01</span> <span class="op">*</span> user_age <span class="op">+</span> <span class="fl">0.02</span> <span class="op">*</span> np.sin(time_of_day <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">/</span> <span class="dv">24</span>) <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> website_context_factor </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>prob_click <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>z))</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>ad_clicked <span class="op">=</span> (prob_click <span class="op">&gt;</span> np.random.rand(n_impressions)).astype(<span class="bu">int</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>df_q3 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'UserAge'</span>: user_age,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TimeOfDay'</span>: time_of_day,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WebsiteContextFactor'</span>: website_context_factor, <span class="co"># Represents relevance/category</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AdClicked'</span>: ad_clicked</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--- Q3: Ad Click Data ---"</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display basic info (optional uncomment)</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q3.head())</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nData Info:")</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q3.info())</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nClick Distribution:") # Expect low click rate</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q3['AdClicked'].value_counts(normalize=True)) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Q3: Ad Click Data ---</code></pre>
</div>
</div>
<ul>
<li><strong>Starter Code:</strong></li>
</ul>
<div id="starter-q3" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Starter code for Q3</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume df_q3 is loaded from the generation code above</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Q3 Data Sample:"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_q3.head())</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Your exploration/modeling/evaluation code would start here ---</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>X3 <span class="op">=</span> df_q3[[<span class="st">'UserAge'</span>, <span class="st">'TimeOfDay'</span>, <span class="st">'WebsiteContextFactor'</span>]]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>y3 <span class="op">=</span> df_q3[<span class="st">'AdClicked'</span>]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Train/Test Split</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># X3_train, X3_test, y3_train, y3_test = train_test_split(</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     X3, y3, test_size=0.30, random_state=GLOBAL_RANDOM_STATE, stratify=y3</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Q3 Data Sample:
   UserAge  TimeOfDay  WebsiteContextFactor  AdClicked
0       38         10              1.159705          0
1       53          8              0.323269          0
2       63         22             -0.336128          0
3       21          3             -0.778261          0
4       50         19             -2.583400          0</code></pre>
</div>
</div>
<ul>
<li><strong>Questions:</strong>
<ul>
<li><ol type="a">
<li>Define the classification task. What is Y?</li>
</ol></li>
<li><ol start="2" type="a">
<li>Suppose the agency trains a logistic regression model. How could they use the <code>predict_proba()</code> output to decide which users to show the ad to, assuming showing the ad has a small cost per impression?</li>
</ol></li>
<li><ol start="3" type="a">
<li>The model predicts the following click probabilities for two different scenarios: Scenario 1: P(Click) = 0.015, Scenario 2: P(Click) = 0.008. Which scenario suggests a higher likelihood of a click? How might the agency use this comparison?</li>
</ol></li>
<li><ol start="4" type="a">
<li>The agency tests the model on unseen data and gets the following results for predicting <code>AdClicked</code> (1=Clicked, 0=Not Clicked): Accuracy=0.95, Precision=0.15, Recall=0.60, F1=0.24. Why might <strong>Precision</strong> be low even if Recall is relatively high? What does this suggest about the model’s positive predictions (predictions of a click)?</li>
</ol></li>
<li><ol start="5" type="a">
<li>If the cost of showing an ad is very low, but the value of a click is high (e.g., leads to a potential large sale), which metric (<strong>Precision or Recall</strong>) might the agency prioritize optimizing when predicting clicks? Why?</li>
</ol></li>
</ul></li>
</ul>
<hr>
<p><strong>Question 4: Software Subscription Renewal</strong></p>
<ul>
<li><strong>Scenario:</strong> A SaaS company wants to proactively identify customers unlikely to renew their annual subscription and evaluate the performance of their prediction model.</li>
<li><strong>Data Generation Code:</strong></li>
</ul>
<div id="generate-q4-data" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Generate Q4 Data ---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(GLOBAL_RANDOM_STATE <span class="op">+</span> <span class="dv">3</span>) <span class="co"># Use global state + offset</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>n_customers <span class="op">=</span> <span class="dv">400</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>months_subscribed <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">48</span>, n_customers)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>support_tickets_logged <span class="op">=</span> np.random.poisson(<span class="dv">2</span>, n_customers)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>avg_monthly_usage <span class="op">=</span> np.random.normal(<span class="dv">20</span>, <span class="dv">10</span>, n_customers) <span class="co"># Hours</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of renewal increases with tenure and usage, decreases with support tickets</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.03</span> <span class="op">*</span> months_subscribed <span class="op">-</span> <span class="fl">0.3</span> <span class="op">*</span> support_tickets_logged <span class="op">+</span> <span class="fl">0.05</span> <span class="op">*</span> avg_monthly_usage</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>prob_renew <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>z))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>did_renew <span class="op">=</span> (prob_renew <span class="op">&gt;</span> np.random.rand(n_customers)).astype(<span class="bu">int</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure positive usage</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>avg_monthly_usage <span class="op">=</span> np.maximum(avg_monthly_usage, <span class="dv">0</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>df_q4 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'MonthsSubscribed'</span>: months_subscribed,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SupportTicketsLogged'</span>: support_tickets_logged,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AvgMonthlyUsage'</span>: avg_monthly_usage,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DidRenew'</span>: did_renew</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--- Q4: Subscription Renewal Data ---"</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Display basic info (optional uncomment)</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q4.head())</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nData Info:")</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q4.info())</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nRenewal Distribution:")</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q4['DidRenew'].value_counts(normalize=True))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Q4: Subscription Renewal Data ---</code></pre>
</div>
</div>
<ul>
<li><strong>Starter Code:</strong></li>
</ul>
<div id="starter-q4" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Starter code for Q4</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume df_q4 is loaded from the generation code above</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Q4 Data Sample:"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_q4.head())</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Your exploration/modeling/evaluation code would start here ---</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>X4 <span class="op">=</span> df_q4[[<span class="st">'MonthsSubscribed'</span>, <span class="st">'SupportTicketsLogged'</span>, <span class="st">'AvgMonthlyUsage'</span>]]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>y4 <span class="op">=</span> df_q4[<span class="st">'DidRenew'</span>]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Train/Test Split</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># X4_train, X4_test, y4_train, y4_test = train_test_split(</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     X4, y4, test_size=0.25, random_state=GLOBAL_RANDOM_STATE, stratify=y4</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Q4 Data Sample:
   MonthsSubscribed  SupportTicketsLogged  AvgMonthlyUsage  DidRenew
0                12                     0         0.000000         0
1                31                     4        34.547487         1
2                 4                     3         9.296573         1
3                33                     1        12.987061         1
4                32                     1        39.027546         1</code></pre>
</div>
</div>
<ul>
<li><strong>Questions:</strong>
<ul>
<li><ol type="a">
<li>What is the dependent variable (Y) for a logistic regression model aimed at predicting renewal?</li>
</ol></li>
<li><ol start="2" type="a">
<li>If the coefficient for <code>AvgMonthlyUsage</code> is positive, what does that suggest about the relationship between usage and renewal likelihood?</li>
</ol></li>
<li><ol start="3" type="a">
<li>The company wants to identify customers likely to <em>not renew</em> (DidRenew=0) so they can intervene. They find that using the default 0.5 threshold on P(Renew) results in missing many customers who actually don’t renew. How could they adjust the decision threshold based on P(Renew) to increase the <strong>Recall</strong> for predicting non-renewal? What is a potential downside of this adjustment?</li>
</ol></li>
<li><ol start="4" type="a">
<li>Fit a logistic regression model using a train/test split. Generate the <strong>classification report</strong> for the model predictions on the <em>test set</em>. Explain what the ‘support’ column represents in this report.</li>
</ol></li>
<li><ol start="5" type="a">
<li>Let’s consider predicting ‘Will Not Renew’ (DidRenew=0) as the “positive” class for intervention purposes. If the cost of the intervention (e.g., offering a discount to a customer who would have renewed anyway) is high, should the company prioritize <strong>Precision or Recall</strong> for <em>this specific task</em> (predicting non-renewal)? Explain your reasoning.</li>
</ol></li>
</ul></li>
</ul>
<hr>
<p><strong>Question 5: Email Spam Filtering</strong></p>
<ul>
<li><strong>Scenario:</strong> An email provider wants to improve its spam filter and needs to evaluate its performance carefully, considering user experience.</li>
<li><strong>Data Generation Code:</strong></li>
</ul>
<div id="generate-q5-data" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Generate Q5 Data ---</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(GLOBAL_RANDOM_STATE <span class="op">+</span> <span class="dv">4</span>) <span class="co"># Use global state + offset</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>n_emails <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>contains_keyword_offer <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">2</span>, n_emails) <span class="co"># 0 or 1</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>has_attachments <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">2</span>, n_emails)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate known sender: Less likely to be known if spam keywords present</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>known_sender_base_prob <span class="op">=</span> <span class="fl">0.7</span> <span class="op">-</span> <span class="fl">0.4</span> <span class="op">*</span> contains_keyword_offer</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>sender_known <span class="op">=</span> (known_sender_base_prob <span class="op">&gt;</span> np.random.rand(n_emails)).astype(<span class="bu">int</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of spam increases with keywords, slightly with attachments, decreases a lot if sender known</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">+</span> <span class="fl">2.0</span> <span class="op">*</span> contains_keyword_offer <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> has_attachments <span class="op">-</span> <span class="fl">2.5</span> <span class="op">*</span> sender_known</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>prob_spam <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>z))</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>is_spam <span class="op">=</span> (prob_spam <span class="op">&gt;</span> np.random.rand(n_emails)).astype(<span class="bu">int</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>df_q5 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ContainsKeywordOffer'</span>: contains_keyword_offer,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'HasAttachments'</span>: has_attachments,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SenderKnown'</span>: sender_known,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'IsSpam'</span>: is_spam</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--- Q5: Email Spam Data ---"</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Display basic info (optional uncomment)</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q5.head())</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nData Info:")</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q5.info())</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nSpam Distribution:")</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_q5['IsSpam'].value_counts(normalize=True))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Q5: Email Spam Data ---</code></pre>
</div>
</div>
<ul>
<li><strong>Starter Code:</strong></li>
</ul>
<div id="starter-q5" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Starter code for Q5</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume df_q5 is loaded from the generation code above</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Q5 Data Sample:"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_q5.head())</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Your exploration/modeling/evaluation code would start here ---</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>X5 <span class="op">=</span> df_q5[[<span class="st">'ContainsKeywordOffer'</span>, <span class="st">'HasAttachments'</span>, <span class="st">'SenderKnown'</span>]]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>y5 <span class="op">=</span> df_q5[<span class="st">'IsSpam'</span>]</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Train/Test Split</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># X5_train, X5_test, y5_train, y5_test = train_test_split(</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     X5, y5, test_size=0.30, random_state=GLOBAL_RANDOM_STATE, stratify=y5</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Q5 Data Sample:
   ContainsKeywordOffer  HasAttachments  SenderKnown  IsSpam
0                     1               1            0       1
1                     1               0            0       1
2                     0               0            1       0
3                     0               1            1       0
4                     0               1            0       0</code></pre>
</div>
</div>
<ul>
<li><strong>Questions:</strong>
<ul>
<li><ol type="a">
<li>What is the dependent variable (Y) and what are the independent variables (X) listed?</li>
</ol></li>
<li><ol start="2" type="a">
<li>The logistic regression model yields an odds ratio of 0.10 for the <code>SenderKnown</code> variable. Interpret this odds ratio in plain English.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Fit a logistic regression model using a train/test split. Calculate the <strong>confusion matrix</strong> and <strong>classification report</strong> for the spam filter model on the <em>test set</em>.</li>
</ol></li>
<li><ol start="4" type="a">
<li>Interpret the <strong>Precision</strong> and <strong>Recall</strong> specifically for the ‘Spam’ class (IsSpam=1) from your classification report.</li>
</ol></li>
<li><ol start="5" type="a">
<li>Why are Precision and Recall often considered more informative than overall accuracy for evaluating a spam filter? Relate this to the potential consequences of False Positives and False Negatives in this context.</li>
</ol></li>
</ul></li>
</ul>
</section>
<section id="solutions-with-code-demonstrations" class="level2">
<h2 class="anchored" data-anchor-id="solutions-with-code-demonstrations">Solutions with Code Demonstrations</h2>
<hr>
<p><strong>Solution 1: E-commerce Website Conversion</strong></p>
<ul>
<li><ol type="a">
<li><ul>
<li><strong>Dependent Variable (Y):</strong> <code>MadePurchase</code> (Binary: 1 = Purchase, 0 = No Purchase).</li>
<li><strong>Independent Variables (X):</strong> <code>TimeOnSite</code>, <code>PagesViewed</code>, <code>CameFromAd</code>.</li>
</ul></li>
</ol></li>
<li><ol start="2" type="a">
<li><ul>
<li><strong>Calculation:</strong> Odds Ratio = <code>exp(0.15) ≈ 1.16</code>.</li>
<li><strong>Interpretation:</strong> For each additional page viewed, the odds of making a purchase are multiplied by 1.16 (i.e., increase by about 16%), holding <code>TimeOnSite</code> and <code>CameFromAd</code> constant.</li>
</ul></li>
</ol></li>
<li><ol start="3" type="a">
<li><ul>
<li><strong>Predictions (0.5 threshold):</strong> Session A (P=0.65 &gt; 0.5) -&gt; Predict Purchase (1); Session B (P=0.40 &lt; 0.5) -&gt; Predict No Purchase (0).</li>
<li><strong>Using Probabilities:</strong> Retailers can use probabilities for targeted actions: offer a chat prompt or discount for medium probability (e.g., 0.3-0.6), prioritize support for high probability, or tag low probability users for later remarketing.</li>
</ul></li>
</ol></li>
<li><ol start="4" type="a">
<li><ul>
<li><strong>Given Matrix:</strong> TN=100, FP=10, FN=20, TP=30. Total = 100+10+20+30 = 160.</li>
<li><strong>Accuracy:</strong> (TP + TN) / Total = (30 + 100) / 160 = 130 / 160 = 0.8125 (or 81.25%). Overall proportion of correct predictions.</li>
<li><strong>Precision:</strong> TP / (TP + FP) = 30 / (30 + 10) = 30 / 40 = 0.75 (or 75%). When the model predicts a purchase, it’s correct 75% of the time.</li>
<li><strong>Recall:</strong> TP / (TP + FN) = 30 / (30 + 20) = 30 / 50 = 0.60 (or 60%). The model correctly identifies 60% of all actual purchases.</li>
<li><strong>F1-Score:</strong> 2 * (Precision * Recall) / (Precision + Recall) = 2 * (0.75 * 0.60) / (0.75 + 0.60) = 2 * 0.45 / 1.35 = 0.90 / 1.35 ≈ 0.667. The harmonic mean, balancing Precision and Recall.</li>
</ul></li>
</ol></li>
<li><ol start="5" type="a">
<li><ul>
<li><strong>Concern:</strong> Likely more concerned with <strong>low Precision</strong>.</li>
<li><strong>Reasoning:</strong> Business actions based on predicting a purchase might involve offering discounts or incentives. If Precision is low (many False Positives), the retailer wastes money offering discounts to visitors who weren’t actually likely to buy or would have bought anyway. While missing some potential buyers (low Recall) isn’t ideal, the cost of unnecessary incentives might be higher. The optimal balance depends on the exact costs and benefits.</li>
</ul></li>
</ol></li>
<li><strong>Solution Code Demonstration (Illustrates fitting, odds ratio, prediction, and calculating metrics from a generated confusion matrix):</strong></li>
</ul>
<div id="solution-q1" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Solution Code Q1 ---</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Q1 Solution Code ---"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>X1 <span class="op">=</span> df_q1[[<span class="st">'TimeOnSite'</span>, <span class="st">'PagesViewed'</span>, <span class="st">'CameFromAd'</span>]]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> df_q1[<span class="st">'MadePurchase'</span>]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Train/Test Split ---</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>X1_train, X1_test, y1_train, y1_test <span class="op">=</span> train_test_split(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    X1, y1, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span>GLOBAL_RANDOM_STATE, stratify<span class="op">=</span>y1</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Train set size: </span><span class="sc">{</span>X1_train<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Test set size: </span><span class="sc">{</span>X1_test<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Fit model on Training Data ---</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>GLOBAL_RANDOM_STATE, solver<span class="op">=</span><span class="st">'liblinear'</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>model1.fit(X1_train, y1_train)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Interpret Coeffs/OR (Part b) ---</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>coefs1 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Feature'</span>: X1_train.columns,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Coefficient'</span>: model1.coef_[<span class="dv">0</span>],</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Odds Ratio'</span>: np.exp(model1.coef_[<span class="dv">0</span>])</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Coefficients and Odds Ratios from Trained Model:"</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coefs1)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Interpretation for PagesViewed OR (</span><span class="sc">{</span>coefs1<span class="sc">.</span>iloc[<span class="dv">1</span>, <span class="dv">2</span>]<span class="sc">:.2f}</span><span class="ss">) aligns with question (b)."</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Make Predictions (Part c - conceptually) ---</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co"># We use predict_proba for probabilities, predict for labels based on 0.5 threshold</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Example prediction code was illustrative in problem set starter code.</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Evaluate on Test Data (Part d - using given matrix values) ---</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually calculating based on the matrix provided in the question</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> <span class="dv">100</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> tn <span class="op">+</span> fp <span class="op">+</span> fn <span class="op">+</span> tp</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>accuracy_q1d <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> total</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>precision_q1d <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>recall_q1d <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn)</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>f1_q1d <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (precision_q1d <span class="op">*</span> recall_q1d) <span class="op">/</span> (precision_q1d <span class="op">+</span> recall_q1d)</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Metrics Calculated from Q1d Matrix ---"</span>)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy:  (</span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> + </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss">) / </span><span class="sc">{</span>total<span class="sc">}</span><span class="ss"> = </span><span class="sc">{</span>accuracy_q1d<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Precision: </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> / (</span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> + </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss">) = </span><span class="sc">{</span>precision_q1d<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recall:    </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> / (</span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> + </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">) = </span><span class="sc">{</span>recall_q1d<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"F1-Score:  Calculated = </span><span class="sc">{</span>f1_q1d<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Discussion (Part e) ---</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Discussion (Q1e): Low precision (many FP) means wasted marketing spend on users not likely to buy. This is often a primary concern."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Q1 Solution Code ---
Train set size: 375, Test set size: 125

Coefficients and Odds Ratios from Trained Model:
       Feature  Coefficient  Odds Ratio
0   TimeOnSite     0.004518    1.004529
1  PagesViewed     0.105328    1.111075
2   CameFromAd    -0.015493    0.984626
Interpretation for PagesViewed OR (1.11) aligns with question (b).

--- Metrics Calculated from Q1d Matrix ---
Accuracy:  (30 + 100) / 160 = 0.8125
Precision: 30 / (30 + 10) = 0.7500
Recall:    30 / (30 + 20) = 0.6000
F1-Score:  Calculated = 0.6667

Discussion (Q1e): Low precision (many FP) means wasted marketing spend on users not likely to buy. This is often a primary concern.</code></pre>
</div>
</div>
<hr>
<p><strong>Solution 2: Loan Application Risk Assessment</strong></p>
<ul>
<li><ol type="a">
<li><ul>
<li><strong>Primary Goal:</strong> Predict the probability that a loan applicant will default on their loan.</li>
<li><strong>Dependent Variable (Y):</strong> <code>LoanDefaulted</code> (Binary: 1 = Defaulted, 0 = Did Not Default).</li>
</ul></li>
</ol></li>
<li><ol start="2" type="a">
<li><ul>
<li><strong>Interpretation:</strong> For each one-point increase in <code>CreditScore</code>, the odds of the applicant defaulting decrease by 2% (multiplied by 0.98), holding <code>LoanAmount</code> and <code>AnnualIncome</code> constant. Higher credit scores indicate lower default risk.</li>
</ul></li>
</ol></li>
<li><ol start="3" type="a">
<li><ul>
<li><strong>Interpretation:</strong> For each $1 increase in <code>LoanAmount</code>, the odds of the applicant defaulting increase by 5% (multiplied by 1.05), holding <code>CreditScore</code> and <code>AnnualIncome</code> constant.</li>
<li><strong>Logical:</strong> Yes, this is logical. Larger loans represent a greater financial burden and potentially higher risk for both the lender and borrower, making default slightly more likely.</li>
</ul></li>
</ol></li>
<li><ol start="4" type="a">
<li><ul>
<li><strong>TP (True Positive):</strong> The model correctly predicted ‘Default’ (1) for an applicant who actually did default. (Correctly identified a risky applicant).</li>
<li><strong>TN (True Negative):</strong> The model correctly predicted ‘No Default’ (0) for an applicant who actually did not default. (Correctly identified a safe applicant).</li>
<li><strong>FP (False Positive):</strong> The model incorrectly predicted ‘Default’ (1) for an applicant who actually did <em>not</em> default. (Incorrectly flagged a safe applicant as risky - potentially denying a good loan).</li>
<li><strong>FN (False Negative):</strong> The model incorrectly predicted ‘No Default’ (0) for an applicant who actually <em>did</em> default. (Incorrectly flagged a risky applicant as safe - potentially approving a bad loan).</li>
</ul></li>
</ol></li>
<li><ol start="5" type="a">
<li><ul>
<li><strong>Importance of Recall:</strong> High Recall is crucial because it measures the model’s ability to find <em>actual</em> defaulters (minimize False Negatives).</li>
<li><strong>Consequence of Low Recall:</strong> A low Recall means the model misses many applicants who will actually default (high FN rate). Approving these loans leads to financial losses for the bank. Therefore, minimizing False Negatives (maximizing Recall) is often a primary objective, even if it means rejecting a few potentially good applicants (lower Precision due to higher FP).</li>
</ul></li>
</ol></li>
<li><strong>Solution Code Demonstration (Illustrates fitting, splitting, interpreting metrics’ meaning):</strong></li>
</ul>
<div id="solution-q2" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Solution Code Q2 ---</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Q2 Solution Code ---"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>X2 <span class="op">=</span> df_q2[[<span class="st">'CreditScore'</span>, <span class="st">'LoanAmount'</span>, <span class="st">'AnnualIncome'</span>]]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> df_q2[<span class="st">'LoanDefaulted'</span>]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Train/Test Split ---</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>X2_train, X2_test, y2_train, y2_test <span class="op">=</span> train_test_split(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    X2, y2, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span>GLOBAL_RANDOM_STATE, stratify<span class="op">=</span>y2</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Train set size: </span><span class="sc">{</span>X2_train<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Test set size: </span><span class="sc">{</span>X2_test<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Fit model on Training Data ---</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Scaling features (e.g., using StandardScaler) is often recommended before fitting Logistic Regression,</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># especially if using regularization or comparing coefficient magnitudes. We omit it here for simplicity</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># matching the lecture, but it's good practice.</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>GLOBAL_RANDOM_STATE, solver<span class="op">=</span><span class="st">'liblinear'</span>, max_iter<span class="op">=</span><span class="dv">1000</span>) </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>model2.fit(X2_train, y2_train)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Interpret Coeffs/OR (Parts b, c - conceptually based on question values) ---</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Code could calculate actual ORs from model2, but we focus on interpretation of given values.</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpreting Odds Ratios (Q2b, Q2c based on question text):"</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"OR=0.98 for CreditScore means 1pt increase -&gt; 2</span><span class="sc">% d</span><span class="st">ecrease in default odds."</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"OR=1.05 for LoanAmount means $1 increase -&gt; 5</span><span class="sc">% i</span><span class="st">ncrease in default odds."</span>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Evaluate on Test Data ---</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>y2_pred <span class="op">=</span> model2.predict(X2_test)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Explain CM Components (Part d) ---</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>cm2 <span class="op">=</span> confusion_matrix(y2_test, y2_pred)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> cm2.ravel()</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Confusion Matrix (Actual vs Predicted Default) ---"</span>)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cm2)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"TN: </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> (Predicted No Default, Actual No Default)"</span>)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"FP: </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> (Predicted Default, Actual No Default) - Potential unnecessary rejection"</span>)</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"FN: </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> (Predicted No Default, Actual Default) - Potential loss from bad loan"</span>)</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"TP: </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> (Predicted Default, Actual Default)"</span>)</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Discussion on Recall (Part e) ---</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>recall_q2 <span class="op">=</span> recall_score(y2_test, y2_pred) <span class="co"># Specifically for class 1 (Default)</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Calculated Recall for Default Class: </span><span class="sc">{</span>recall_q2<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Discussion (Q2e): Recall measures ability to find actual defaulters."</span>)</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Low recall (high FN) means approving loans that will default, leading to direct financial loss."</span>)</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Therefore, Recall is often prioritized in risk assessment."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Q2 Solution Code ---
Train set size: 450, Test set size: 150

Interpreting Odds Ratios (Q2b, Q2c based on question text):
OR=0.98 for CreditScore means 1pt increase -&gt; 2% decrease in default odds.
OR=1.05 for LoanAmount means $1 increase -&gt; 5% increase in default odds.

--- Confusion Matrix (Actual vs Predicted Default) ---
[[146   0]
 [  4   0]]
TN: 146 (Predicted No Default, Actual No Default)
FP: 0 (Predicted Default, Actual No Default) - Potential unnecessary rejection
FN: 4 (Predicted No Default, Actual Default) - Potential loss from bad loan
TP: 0 (Predicted Default, Actual Default)

Calculated Recall for Default Class: 0.0000

Discussion (Q2e): Recall measures ability to find actual defaulters.
Low recall (high FN) means approving loans that will default, leading to direct financial loss.
Therefore, Recall is often prioritized in risk assessment.</code></pre>
</div>
</div>
<hr>
<p><strong>Solution 3: Targeted Online Advertising</strong></p>
<ul>
<li><ol type="a">
<li><ul>
<li><strong>Classification Task:</strong> Predict whether a user clicks on a specific online banner ad based on their characteristics and the context.</li>
<li><strong>Dependent Variable (Y):</strong> <code>AdClicked</code> (Binary: 1 = Clicked, 0 = Did Not Click).</li>
</ul></li>
</ol></li>
<li><ol start="2" type="a">
<li><ul>
<li>The agency can use <code>predict_proba()</code> to get P(Click) for each user/impression. They can set a probability threshold (e.g., <code>P(Click) &gt; 0.01</code>) and only show the ad to users exceeding this threshold. This helps focus the budget on impressions more likely to convert, improving ROI.</li>
</ul></li>
</ol></li>
<li><ol start="3" type="a">
<li><ul>
<li><strong>Comparison:</strong> Scenario 1 (P=0.015) indicates a higher likelihood of a click compared to Scenario 2 (P=0.008).</li>
<li><strong>Usage:</strong> The agency can use this comparison to: 1) Prioritize showing the ad under conditions similar to Scenario 1. 2) Analyze <em>why</em> Scenario 1 is better (e.g., the higher <code>WebsiteContextFactor</code>). 3) Potentially adjust bids in real-time bidding systems based on predicted click probability.</li>
</ul></li>
</ol></li>
<li><ol start="4" type="a">
<li><ul>
<li><strong>Low Precision, High Recall:</strong> High Recall (0.60) means the model identifies 60% of the users who <em>actually</em> clicked. However, low Precision (0.15) means that when the model <em>predicts</em> a click, it’s only correct 15% of the time. This implies the model makes many <strong>False Positive</strong> predictions – it predicts clicks for many users who don’t actually click. This often happens in highly imbalanced datasets (like ad clicks) where the model tries hard to catch the rare positive cases (clicks), leading it to incorrectly flag many negative cases as positive.</li>
</ul></li>
</ol></li>
<li><ol start="5" type="a">
<li><ul>
<li><strong>Prioritize:</strong> Likely prioritize <strong>Recall</strong>.</li>
<li><strong>Reasoning:</strong> If the cost per impression is very low and the value of a click is high, the agency wants to capture as many potential clickers as possible, even if it means showing the ad to some users who won’t click (lower Precision). The cost of missing a valuable click (False Negative) outweighs the cost of a few wasted impressions (False Positive). Maximizing Recall helps ensure high-potential users see the ad.</li>
</ul></li>
</ol></li>
<li><strong>Solution Code Demonstration (Illustrates fitting, splitting, interpreting hypothetical metrics):</strong></li>
</ul>
<div id="solution-q3" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Solution Code Q3 ---</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Q3 Solution Code ---"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>X3 <span class="op">=</span> df_q3[[<span class="st">'UserAge'</span>, <span class="st">'TimeOfDay'</span>, <span class="st">'WebsiteContextFactor'</span>]]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>y3 <span class="op">=</span> df_q3[<span class="st">'AdClicked'</span>]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Train/Test Split ---</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Click data is often highly imbalanced, stratify is important</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>X3_train, X3_test, y3_train, y3_test <span class="op">=</span> train_test_split(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    X3, y3, test_size<span class="op">=</span><span class="fl">0.30</span>, random_state<span class="op">=</span>GLOBAL_RANDOM_STATE, stratify<span class="op">=</span>y3</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Train set size: </span><span class="sc">{</span>X3_train<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Test set size: </span><span class="sc">{</span>X3_test<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Click rate in Test set: </span><span class="sc">{</span>y3_test<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss">"</span>) <span class="co"># Check imbalance</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Fit model on Training Data ---</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>model3 <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>GLOBAL_RANDOM_STATE, solver<span class="op">=</span><span class="st">'liblinear'</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>model3.fit(X3_train, y3_train)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Use predict_proba (Part b, c - conceptually) ---</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Code demonstration in problem set starter code was illustrative.</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Evaluate on Test Data (Interpret hypothetical metrics from Part d) ---</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co"># We use the metrics given in the question for discussion.</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>accuracy_q3d, precision_q3d, recall_q3d, f1_q3d <span class="op">=</span> <span class="fl">0.95</span>, <span class="fl">0.15</span>, <span class="fl">0.60</span>, <span class="fl">0.24</span> </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Interpreting Metrics from Q3d ---"</span>)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy:  </span><span class="sc">{</span>accuracy_q3d<span class="sc">:.2f}</span><span class="ss"> (High overall correctness)"</span>)</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Precision: </span><span class="sc">{</span>precision_q3d<span class="sc">:.2f}</span><span class="ss"> (Only 15% of predicted clicks are actual clicks -&gt; Many FPs)"</span>)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recall:    </span><span class="sc">{</span>recall_q3d<span class="sc">:.2f}</span><span class="ss"> (Finds 60% of actual clicks -&gt; Catches a decent portion)"</span>)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"F1-Score:  </span><span class="sc">{</span>f1_q3d<span class="sc">:.2f}</span><span class="ss"> (Low overall balance due to very low Precision)"</span>)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Discussion (Q3d): Low Precision with high Recall suggests the model flags many non-clickers as clickers (high FP rate) in its attempt to find the rare clicks."</span>)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Discussion (Part e) ---</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Discussion (Q3e): With low ad cost &amp; high click value, prioritize Recall to maximize capturing valuable clicks, even with some wasted impressions."</span>)</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Optional: Calculate actual metrics from *this* model/data split ---</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>y3_pred <span class="op">=</span> model3.predict(X3_test)</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Actual Metrics from this Model Run (for comparison) ---"</span>)</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: These will vary based on the random data generation!</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Use zero_division=0 to handle cases where Precision/Recall might be 0 if no clicks predicted/occurred</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y3_test, y3_pred, zero_division<span class="op">=</span><span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Q3 Solution Code ---
Train set size: 700, Test set size: 300
Click rate in Test set: 0.0033

--- Interpreting Metrics from Q3d ---
Accuracy:  0.95 (High overall correctness)
Precision: 0.15 (Only 15% of predicted clicks are actual clicks -&gt; Many FPs)
Recall:    0.60 (Finds 60% of actual clicks -&gt; Catches a decent portion)
F1-Score:  0.24 (Low overall balance due to very low Precision)

Discussion (Q3d): Low Precision with high Recall suggests the model flags many non-clickers as clickers (high FP rate) in its attempt to find the rare clicks.

Discussion (Q3e): With low ad cost &amp; high click value, prioritize Recall to maximize capturing valuable clicks, even with some wasted impressions.

--- Actual Metrics from this Model Run (for comparison) ---
              precision    recall  f1-score   support

           0       1.00      1.00      1.00       299
           1       0.00      0.00      0.00         1

    accuracy                           1.00       300
   macro avg       0.50      0.50      0.50       300
weighted avg       0.99      1.00      1.00       300
</code></pre>
</div>
</div>
<hr>
<p><strong>Solution 4: Software Subscription Renewal</strong></p>
<ul>
<li><ol type="a">
<li><ul>
<li><strong>Dependent Variable (Y):</strong> <code>DidRenew</code> (Binary: 1 = Renewed, 0 = Did Not Renew).</li>
</ul></li>
</ol></li>
<li><ol start="2" type="a">
<li><ul>
<li><strong>Interpretation:</strong> A positive coefficient suggests that higher average monthly usage is associated with higher log-odds (and thus higher probability) of renewal, holding subscription duration and support tickets constant. More active users are more likely to renew.</li>
</ul></li>
</ol></li>
<li><ol start="3" type="a">
<li><ul>
<li><strong>Adjustment:</strong> To increase Recall for non-renewal (DidRenew=0), they need to predict ‘DidRenew=0’ more often. This means lowering the threshold required to predict ‘DidRenew=1’. Instead of predicting ‘Renew’ if P(Renew) ≥ 0.5, they could use a higher threshold, e.g., predict ‘Renew’ only if P(Renew) ≥ 0.6 or 0.7. Equivalently, predict ‘Not Renew’ if P(Renew) &lt; 0.6 or &lt; 0.7 (instead of &lt; 0.5).</li>
<li><strong>Downside:</strong> This will increase the number of False Positives for non-renewal (i.e., flagging customers for intervention who would have renewed anyway), potentially wasting resources or unnecessarily discounting. This lowers Precision for the non-renewal prediction.</li>
</ul></li>
</ol></li>
<li><ol start="4" type="a">
<li><ul>
<li><strong>Classification Report:</strong> See code output below.</li>
<li><strong>‘Support’ Column:</strong> The ‘support’ column indicates the number of actual occurrences of each class in the test dataset (the true instances for ‘DidRenew=0’ and ‘DidRenew=1’).</li>
</ul></li>
</ol></li>
<li><ol start="5" type="a">
<li><ul>
<li><strong>Prioritize:</strong> Prioritize <strong>Precision</strong> for predicting non-renewal (DidRenew=0).</li>
<li><strong>Reasoning:</strong> The “positive” class for action is ‘Will Not Renew’ (DidRenew=0). A False Positive here means intervening (e.g., offering a discount) for a customer who was actually going to renew anyway. If the intervention cost is high, the company wants to be very sure that a customer flagged for intervention is truly at risk. High Precision minimizes these costly False Positives. Missing some customers who don’t renew (lower Recall) might be acceptable if the cost of unnecessary interventions is too high.</li>
</ul></li>
</ol></li>
<li><strong>Solution Code Demonstration (Illustrates fitting, splitting, threshold adjustment logic, classification report):</strong></li>
</ul>
<div id="solution-q4" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Solution Code Q4 ---</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Q4 Solution Code ---"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>X4 <span class="op">=</span> df_q4[[<span class="st">'MonthsSubscribed'</span>, <span class="st">'SupportTicketsLogged'</span>, <span class="st">'AvgMonthlyUsage'</span>]]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>y4 <span class="op">=</span> df_q4[<span class="st">'DidRenew'</span>]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Train/Test Split ---</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>X4_train, X4_test, y4_train, y4_test <span class="op">=</span> train_test_split(</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    X4, y4, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span>GLOBAL_RANDOM_STATE, stratify<span class="op">=</span>y4</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Train set size: </span><span class="sc">{</span>X4_train<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Test set size: </span><span class="sc">{</span>X4_test<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Fit model on Training Data ---</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>model4 <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>GLOBAL_RANDOM_STATE, solver<span class="op">=</span><span class="st">'liblinear'</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>model4.fit(X4_train, y4_train)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Interpret Coeff (Part b) ---</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>coefs4 <span class="op">=</span> pd.DataFrame({<span class="st">'Feature'</span>: X4_train.columns, <span class="st">'Coefficient'</span>: model4.coef_[<span class="dv">0</span>]})</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>usage_coef <span class="op">=</span> coefs4.loc[coefs4[<span class="st">'Feature'</span>] <span class="op">==</span> <span class="st">'AvgMonthlyUsage'</span>, <span class="st">'Coefficient'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Coefficient for AvgMonthlyUsage: </span><span class="sc">{</span>usage_coef<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Positive coefficient aligns with interpretation in (b)."</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Threshold Adjustment (Part c - conceptually) ---</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Discussion (Q4c): To increase Recall for non-renewal (class 0), predict 'Non-Renewal' more easily."</span>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"This means setting a HIGHER threshold for P(Renew=1). E.g., Predict Renew only if P(Renew) &gt;= 0.7."</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The downside is lower Precision for non-renewal (more FPs - intervening unnecessarily)."</span>)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Evaluate on Test Data (Part d) ---</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>y4_pred_proba <span class="op">=</span> model4.predict_proba(X4_test)[:, <span class="dv">1</span>] <span class="co"># Prob(Renew=1)</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>y4_pred_labels <span class="op">=</span> model4.predict(X4_test) <span class="co"># Labels based on 0.5 threshold</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (Test Set, Threshold 0.5) ---"</span>)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: The report uses labels 0 and 1 based on y4_test, y4_pred_labels</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y4_test, y4_pred_labels))</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The 'support' column shows the actual number of instances for each class (0 and 1) in the test set."</span>)</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Discussion (Part e) ---</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Precision/Recall for class 0 (Non-Renewal) is key here.</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co"># --- *** CORRECTED CODE START *** ---</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics specifically for class 0 (Non-Renewal)</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Use pos_label=0 to specify class 0 as the positive class for these calculations</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Set zero_division=0 to avoid warnings/errors if a class isn't predicted</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>precision_0 <span class="op">=</span> precision_score(y4_test, y4_pred_labels, pos_label<span class="op">=</span><span class="dv">0</span>, zero_division<span class="op">=</span><span class="dv">0</span>) </span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>recall_0 <span class="op">=</span> recall_score(y4_test, y4_pred_labels, pos_label<span class="op">=</span><span class="dv">0</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="co"># --- *** CORRECTED CODE </span><span class="re">END</span><span class="co"> *** ---</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Precision for Non-Renewal (Class 0): </span><span class="sc">{</span>precision_0<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recall for Non-Renewal (Class 0):    </span><span class="sc">{</span>recall_0<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Discussion (Q4e): If intervention cost is high, prioritize Precision for predicting non-renewal (Class 0)."</span>)</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"This minimizes intervening with customers who would have renewed anyway (False Positives for Class 0)."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Q4 Solution Code ---
Train set size: 300, Test set size: 100

Coefficient for AvgMonthlyUsage: 0.0377
Positive coefficient aligns with interpretation in (b).

Discussion (Q4c): To increase Recall for non-renewal (class 0), predict 'Non-Renewal' more easily.
This means setting a HIGHER threshold for P(Renew=1). E.g., Predict Renew only if P(Renew) &gt;= 0.7.
The downside is lower Precision for non-renewal (more FPs - intervening unnecessarily).

--- Classification Report (Test Set, Threshold 0.5) ---
              precision    recall  f1-score   support

           0       0.58      0.41      0.48        44
           1       0.62      0.77      0.69        56

    accuracy                           0.61       100
   macro avg       0.60      0.59      0.58       100
weighted avg       0.60      0.61      0.60       100

The 'support' column shows the actual number of instances for each class (0 and 1) in the test set.

Precision for Non-Renewal (Class 0): 0.5806
Recall for Non-Renewal (Class 0):    0.4091

Discussion (Q4e): If intervention cost is high, prioritize Precision for predicting non-renewal (Class 0).
This minimizes intervening with customers who would have renewed anyway (False Positives for Class 0).</code></pre>
</div>
</div>
<hr>
<p><strong>Solution 5: Email Spam Filtering</strong></p>
<ul>
<li><ol type="a">
<li><ul>
<li><strong>Dependent Variable (Y):</strong> <code>IsSpam</code> (Binary: 1 = Spam, 0 = Not Spam/Ham).</li>
<li><strong>Independent Variables (X):</strong> <code>ContainsKeywordOffer</code>, <code>HasAttachments</code>, <code>SenderKnown</code>.</li>
</ul></li>
</ol></li>
<li><ol start="2" type="a">
<li><ul>
<li><strong>Interpretation:</strong> An odds ratio of 0.10 means that emails from known senders (<code>SenderKnown=1</code>) have only 10% of the odds of being spam compared to emails from unknown senders (<code>SenderKnown=0</code>), holding the presence of offers and attachments constant. In simpler terms, knowing the sender makes it much less likely (90% lower odds) that the email is spam.</li>
</ul></li>
</ol></li>
<li><ol start="3" type="a">
<li><ul>
<li><strong>Confusion Matrix &amp; Classification Report:</strong> See code output below.</li>
</ul></li>
</ol></li>
<li><ol start="4" type="a">
<li><ul>
<li><strong>Precision (Spam):</strong> From the report’s ‘Spam’ (or ‘1’) row, Precision indicates: “Of all the emails the filter classified as Spam, what proportion actually <em>were</em> Spam?” A high Precision means fewer legitimate emails are incorrectly marked as spam.</li>
<li><strong>Recall (Spam):</strong> From the report’s ‘Spam’ (or ‘1’) row, Recall indicates: “Of all the emails that actually <em>were</em> Spam, what proportion did the filter correctly identify?” A high Recall means the filter catches most of the incoming spam.</li>
</ul></li>
</ol></li>
<li><ol start="5" type="a">
<li><ul>
<li><strong>Why More Informative:</strong> Accuracy can be high even if the filter performs poorly on the minority class (Spam) because most emails are not spam (class imbalance). Precision and Recall focus specifically on the filter’s performance regarding spam identification and the user impact:
<ul>
<li><strong>Low Precision (High FP):</strong> Many legitimate emails (‘ham’) are incorrectly flagged as spam. This is highly disruptive to the user (missing important emails). User experience suffers greatly.</li>
<li><strong>Low Recall (High FN):</strong> Many actual spam emails get through to the inbox. This is annoying but often less critical than missing important emails.</li>
</ul></li>
<li>Therefore, <strong>Precision for the non-spam (‘ham’) class</strong> is often the most critical metric (minimizing FP for spam prediction), followed by <strong>Recall for the spam class</strong> (catching spam without blocking too much ham). The exact balance depends on user tolerance and provider goals.</li>
</ul></li>
</ol></li>
<li><strong>Solution Code Demonstration (Illustrates fitting, splitting, calculating CM and report, interpreting):</strong></li>
</ul>
<div id="solution-q5" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Solution Code Q5 ---</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Q5 Solution Code ---"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>X5 <span class="op">=</span> df_q5[[<span class="st">'ContainsKeywordOffer'</span>, <span class="st">'HasAttachments'</span>, <span class="st">'SenderKnown'</span>]]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>y5 <span class="op">=</span> df_q5[<span class="st">'IsSpam'</span>]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Train/Test Split ---</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>X5_train, X5_test, y5_train, y5_test <span class="op">=</span> train_test_split(</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    X5, y5, test_size<span class="op">=</span><span class="fl">0.30</span>, random_state<span class="op">=</span>GLOBAL_RANDOM_STATE, stratify<span class="op">=</span>y5</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Train set size: </span><span class="sc">{</span>X5_train<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Test set size: </span><span class="sc">{</span>X5_test<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Fit model on Training Data ---</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>model5 <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span>GLOBAL_RANDOM_STATE, solver<span class="op">=</span><span class="st">'liblinear'</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>model5.fit(X5_train, y5_train)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Interpret OR (Part b - based on question) ---</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpreting Odds Ratio (Q5b based on question text):"</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"OR=0.10 for SenderKnown means known senders have 90</span><span class="sc">% lo</span><span class="st">wer odds of being spam."</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Evaluate on Test Data (Parts c, d) ---</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>y5_pred <span class="op">=</span> model5.predict(X5_test)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Confusion Matrix (Actual vs Predicted Spam) ---"</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Rows: Actual (0=Ham, 1=Spam), Cols: Predicted (0=Ham, 1=Spam)</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>cm5 <span class="op">=</span> confusion_matrix(y5_test, y5_pred)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cm5)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="co"># We can unpack the confusion matrix for clarity if needed</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> cm5.ravel() </span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"TN: </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> (Ham classified as Ham)"</span>)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"FP: </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> (Ham classified as Spam) - *** BAD for User! ***"</span>)</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"FN: </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> (Spam classified as Ham) - Annoying for User"</span>)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"TP: </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> (Spam classified as Spam)"</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (Test Set) ---"</span>)</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="co"># target_names helps interpretation</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y5_test, y5_pred, target_names<span class="op">=</span>[<span class="st">'Ham (0)'</span>, <span class="st">'Spam (1)'</span>]))</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="co"># --- *** CORRECTED CODE START *** ---</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Precision/Recall for Spam (Class 1) for discussion using separate calls</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Use pos_label=1 to specify Spam as the positive class</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Set zero_division=0 to avoid warnings/errors </span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>precision_spam <span class="op">=</span> precision_score(y5_test, y5_pred, pos_label<span class="op">=</span><span class="dv">1</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>recall_spam <span class="op">=</span> recall_score(y5_test, y5_pred, pos_label<span class="op">=</span><span class="dv">1</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a><span class="co"># --- *** CORRECTED CODE </span><span class="re">END</span><span class="co"> *** ---</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation (Q5d):"</span>)</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Now precision_spam and recall_spam hold the correct single values</span></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Precision for Spam (Class 1): </span><span class="sc">{</span>precision_spam<span class="sc">:.4f}</span><span class="ss"> - Proportion of emails flagged as spam that were actually spam."</span>)</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recall for Spam (Class 1):    </span><span class="sc">{</span>recall_spam<span class="sc">:.4f}</span><span class="ss"> - Proportion of actual spam emails caught by the filter."</span>)</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Discussion (Part e) ---</span></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Discussion (Q5e): Accuracy is misleading due to imbalance."</span>)</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Low Precision (for Spam class) means many False Positives (Ham classified as Spam), which is very bad user experience."</span>)</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Low Recall (for Spam class) means many False Negatives (Spam gets through), which is annoying."</span>)</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Often, minimizing False Positives (maximizing Precision for the Ham class) is the highest priority."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Q5 Solution Code ---
Train set size: 700, Test set size: 300

Interpreting Odds Ratio (Q5b based on question text):
OR=0.10 for SenderKnown means known senders have 90% lower odds of being spam.

--- Confusion Matrix (Actual vs Predicted Spam) ---
[[172  40]
 [  9  79]]
TN: 172 (Ham classified as Ham)
FP: 40 (Ham classified as Spam) - *** BAD for User! ***
FN: 9 (Spam classified as Ham) - Annoying for User
TP: 79 (Spam classified as Spam)

--- Classification Report (Test Set) ---
              precision    recall  f1-score   support

     Ham (0)       0.95      0.81      0.88       212
    Spam (1)       0.66      0.90      0.76        88

    accuracy                           0.84       300
   macro avg       0.81      0.85      0.82       300
weighted avg       0.87      0.84      0.84       300


Interpretation (Q5d):
Precision for Spam (Class 1): 0.6639 - Proportion of emails flagged as spam that were actually spam.
Recall for Spam (Class 1):    0.8977 - Proportion of actual spam emails caught by the filter.

Discussion (Q5e): Accuracy is misleading due to imbalance.
Low Precision (for Spam class) means many False Positives (Ham classified as Spam), which is very bad user experience.
Low Recall (for Spam class) means many False Negatives (Spam gets through), which is annoying.
Often, minimizing False Positives (maximizing Precision for the Ham class) is the highest priority.</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>