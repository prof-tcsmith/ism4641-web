<!DOCTYPE html>
<html lang="en"><head>
<script src="Week12-lecture-slides_files/libs/clipboard/clipboard.min.js"></script>
<script src="Week12-lecture-slides_files/libs/quarto-html/tabby.min.js"></script>
<script src="Week12-lecture-slides_files/libs/quarto-html/popper.min.js"></script>
<script src="Week12-lecture-slides_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="Week12-lecture-slides_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Week12-lecture-slides_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="Week12-lecture-slides_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.31">

  <meta name="author" content="Dr.&nbsp;Tim Smith">
  <meta name="dcterms.date" content="2025-04-19">
  <title>ISM4641: Python for Business Analytics</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="Week12-lecture-slides_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="Week12-lecture-slides_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="Week12-lecture-slides_files/libs/revealjs/dist/theme/quarto-f563837468303362081e247dddd440d0.css">
  <link rel="stylesheet" href="../reveal-scroll.css">
  <link href="Week12-lecture-slides_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="Week12-lecture-slides_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="Week12-lecture-slides_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="Week12-lecture-slides_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="Week12-lecture-slides_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="Week12-lecture-slides_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">ISM4641: Python for Business Analytics</h1>
  <p class="subtitle">Week 12: Logistic Regression for Classification</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Dr.&nbsp;Tim Smith 
</div>
</div>
</div>

  <p class="date">April 19, 2025</p>
</section>
<section>
<section id="welcome-to-week-12" class="title-slide slide level1 smaller center">
<h1>Welcome to Week 12!</h1>

</section>
<section id="from-regression-to-classification" class="slide level2">
<h2>From Regression to Classification</h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="why-classification">Why Classification?</h3>
<ul>
<li><strong>Binary Decisions</strong>: Yes/No, Buy/Don’t Buy, Approve/Deny</li>
<li><strong>Risk Assessment</strong>: High/Low risk customers</li>
<li><strong>Customer Segmentation</strong>: Churn/Retain predictions</li>
<li><strong>Quality Control</strong>: Pass/Fail classifications</li>
</ul>
</div><div class="column" style="width:50%;">
<h3 id="what-well-master">What We’ll Master</h3>
<ul>
<li><strong>Logistic vs Linear Regression</strong> differences</li>
<li><strong>Sigmoid Function</strong> for probability modeling</li>
<li><strong>Classification Metrics</strong> (Accuracy, Precision, Recall)</li>
<li><strong>Confusion Matrices</strong> for performance evaluation</li>
<li><strong>Business Applications</strong> of classification models</li>
</ul>
</div></div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Logistic Regression transforms probability estimation into business decision making!</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="part-1-why-linear-regression-fails-for-classification" class="title-slide slide level1 smaller center">
<h1>Part 1: Why Linear Regression Fails for Classification</h1>

</section>
<section id="the-problem-with-continuous-predictions" class="slide level2">
<h2>The Problem with Continuous Predictions</h2>
<div id="7271820e" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href=""></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href=""></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href=""></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href=""></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href=""></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression, LogisticRegression</span>
<span id="cb1-6"><a href=""></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-7"><a href=""></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, precision_score, recall_score, f1_score, confusion_matrix, classification_report</span>
<span id="cb1-8"><a href=""></a><span class="im">import</span> warnings</span>
<span id="cb1-9"><a href=""></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-10"><a href=""></a></span>
<span id="cb1-11"><a href=""></a><span class="co"># Set professional plotting style</span></span>
<span id="cb1-12"><a href=""></a>plt.style.use(<span class="st">'default'</span>)</span>
<span id="cb1-13"><a href=""></a>sns.set_palette(<span class="st">"husl"</span>)</span>
<span id="cb1-14"><a href=""></a></span>
<span id="cb1-15"><a href=""></a><span class="bu">print</span>(<span class="st">"WHY LINEAR REGRESSION FAILS FOR CLASSIFICATION"</span>)</span>
<span id="cb1-16"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">55</span>)</span>
<span id="cb1-17"><a href=""></a></span>
<span id="cb1-18"><a href=""></a><span class="co"># Business scenario: Customer purchase prediction</span></span>
<span id="cb1-19"><a href=""></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb1-20"><a href=""></a>n_customers <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb1-21"><a href=""></a></span>
<span id="cb1-22"><a href=""></a><span class="co"># Generate customer data</span></span>
<span id="cb1-23"><a href=""></a>customer_age <span class="op">=</span> np.random.uniform(<span class="dv">18</span>, <span class="dv">80</span>, n_customers)</span>
<span id="cb1-24"><a href=""></a>customer_income <span class="op">=</span> np.random.uniform(<span class="dv">25000</span>, <span class="dv">150000</span>, n_customers)</span>
<span id="cb1-25"><a href=""></a></span>
<span id="cb1-26"><a href=""></a><span class="co"># Create realistic purchase probability based on age and income</span></span>
<span id="cb1-27"><a href=""></a><span class="co"># Younger, higher income customers more likely to purchase</span></span>
<span id="cb1-28"><a href=""></a>age_effect <span class="op">=</span> (<span class="dv">80</span> <span class="op">-</span> customer_age) <span class="op">/</span> <span class="dv">60</span>  <span class="co"># Younger = higher</span></span>
<span id="cb1-29"><a href=""></a>income_effect <span class="op">=</span> (customer_income <span class="op">-</span> <span class="dv">25000</span>) <span class="op">/</span> <span class="dv">125000</span>  <span class="co"># Higher income = higher</span></span>
<span id="cb1-30"><a href=""></a>base_probability <span class="op">=</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> age_effect <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> income_effect</span>
<span id="cb1-31"><a href=""></a></span>
<span id="cb1-32"><a href=""></a><span class="co"># Add some randomness</span></span>
<span id="cb1-33"><a href=""></a>base_probability <span class="op">+=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.1</span>, n_customers)</span>
<span id="cb1-34"><a href=""></a>base_probability <span class="op">=</span> np.clip(base_probability, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-35"><a href=""></a></span>
<span id="cb1-36"><a href=""></a><span class="co"># Generate actual purchases based on probability</span></span>
<span id="cb1-37"><a href=""></a>purchase_decision <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, base_probability, n_customers)</span>
<span id="cb1-38"><a href=""></a></span>
<span id="cb1-39"><a href=""></a><span class="co"># Create dataset</span></span>
<span id="cb1-40"><a href=""></a>customer_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb1-41"><a href=""></a>    <span class="st">'Age'</span>: customer_age,</span>
<span id="cb1-42"><a href=""></a>    <span class="st">'Income'</span>: customer_income,</span>
<span id="cb1-43"><a href=""></a>    <span class="st">'Purchase_Probability'</span>: base_probability,</span>
<span id="cb1-44"><a href=""></a>    <span class="st">'Purchased'</span>: purchase_decision</span>
<span id="cb1-45"><a href=""></a>})</span>
<span id="cb1-46"><a href=""></a></span>
<span id="cb1-47"><a href=""></a><span class="bu">print</span>(<span class="st">"Customer Purchase Dataset:"</span>)</span>
<span id="cb1-48"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb1-49"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Total Customers: </span><span class="sc">{</span><span class="bu">len</span>(customer_data)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-50"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Purchases: </span><span class="sc">{</span>purchase_decision<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>purchase_decision<span class="sc">.</span>mean()<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb1-51"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Non-Purchases: </span><span class="sc">{</span><span class="bu">len</span>(customer_data) <span class="op">-</span> purchase_decision<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-52"><a href=""></a></span>
<span id="cb1-53"><a href=""></a><span class="co"># Demonstrate linear regression failure</span></span>
<span id="cb1-54"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">LINEAR REGRESSION ATTEMPT:"</span>)</span>
<span id="cb1-55"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb1-56"><a href=""></a></span>
<span id="cb1-57"><a href=""></a><span class="co"># Try linear regression with age as predictor</span></span>
<span id="cb1-58"><a href=""></a>X_age <span class="op">=</span> customer_data[[<span class="st">'Age'</span>]]</span>
<span id="cb1-59"><a href=""></a>y_purchase <span class="op">=</span> customer_data[<span class="st">'Purchased'</span>]</span>
<span id="cb1-60"><a href=""></a></span>
<span id="cb1-61"><a href=""></a>linear_model <span class="op">=</span> LinearRegression()</span>
<span id="cb1-62"><a href=""></a>linear_model.fit(X_age, y_purchase)</span>
<span id="cb1-63"><a href=""></a>linear_predictions <span class="op">=</span> linear_model.predict(X_age)</span>
<span id="cb1-64"><a href=""></a></span>
<span id="cb1-65"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Linear Regression Results:"</span>)</span>
<span id="cb1-66"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  Coefficient: </span><span class="sc">{</span>linear_model<span class="sc">.</span>coef_[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb1-67"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  Intercept: </span><span class="sc">{</span>linear_model<span class="sc">.</span>intercept_<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb1-68"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  Prediction Range: [</span><span class="sc">{</span>linear_predictions<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>linear_predictions<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb1-69"><a href=""></a></span>
<span id="cb1-70"><a href=""></a><span class="co"># Problems with linear regression</span></span>
<span id="cb1-71"><a href=""></a>problems <span class="op">=</span> []</span>
<span id="cb1-72"><a href=""></a><span class="cf">if</span> linear_predictions.<span class="bu">min</span>() <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb1-73"><a href=""></a>    problems.append(<span class="ss">f"Negative predictions (</span><span class="sc">{</span>linear_predictions<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss">)"</span>)</span>
<span id="cb1-74"><a href=""></a><span class="cf">if</span> linear_predictions.<span class="bu">max</span>() <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb1-75"><a href=""></a>    problems.append(<span class="ss">f"Predictions &gt; 1 (</span><span class="sc">{</span>linear_predictions<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">)"</span>)</span>
<span id="cb1-76"><a href=""></a></span>
<span id="cb1-77"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Problems with Linear Regression:"</span>)</span>
<span id="cb1-78"><a href=""></a><span class="cf">if</span> problems:</span>
<span id="cb1-79"><a href=""></a>    <span class="cf">for</span> problem <span class="kw">in</span> problems:</span>
<span id="cb1-80"><a href=""></a>        <span class="bu">print</span>(<span class="ss">f"  ✗ </span><span class="sc">{</span>problem<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-81"><a href=""></a><span class="cf">else</span>:</span>
<span id="cb1-82"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  ✗ Predictions are bounded, but still problematic for probability interpretation"</span>)</span>
<span id="cb1-83"><a href=""></a></span>
<span id="cb1-84"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  ✗ No natural threshold for classification"</span>)</span>
<span id="cb1-85"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  ✗ Assumes linear relationship between features and probability"</span>)</span>
<span id="cb1-86"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  ✗ Poor extrapolation behavior"</span>)</span>
<span id="cb1-87"><a href=""></a></span>
<span id="cb1-88"><a href=""></a><span class="co"># Visualize the problem</span></span>
<span id="cb1-89"><a href=""></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb1-90"><a href=""></a></span>
<span id="cb1-91"><a href=""></a><span class="co"># Linear regression attempt</span></span>
<span id="cb1-92"><a href=""></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb1-93"><a href=""></a><span class="co"># Scatter plot with jitter for binary outcome visibility</span></span>
<span id="cb1-94"><a href=""></a>jittered_purchase <span class="op">=</span> purchase_decision <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.05</span>, n_customers)</span>
<span id="cb1-95"><a href=""></a>ax1.scatter(customer_age, jittered_purchase, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb1-96"><a href=""></a></span>
<span id="cb1-97"><a href=""></a><span class="co"># Linear regression line</span></span>
<span id="cb1-98"><a href=""></a>age_range <span class="op">=</span> np.linspace(<span class="dv">18</span>, <span class="dv">80</span>, <span class="dv">100</span>)</span>
<span id="cb1-99"><a href=""></a>linear_line <span class="op">=</span> linear_model.predict(age_range.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb1-100"><a href=""></a>ax1.plot(age_range, linear_line, color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Linear Regression'</span>)</span>
<span id="cb1-101"><a href=""></a></span>
<span id="cb1-102"><a href=""></a><span class="co"># Horizontal lines at 0 and 1</span></span>
<span id="cb1-103"><a href=""></a>ax1.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Decision Boundaries'</span>)</span>
<span id="cb1-104"><a href=""></a>ax1.axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-105"><a href=""></a></span>
<span id="cb1-106"><a href=""></a>ax1.set_xlabel(<span class="st">'Customer Age'</span>)</span>
<span id="cb1-107"><a href=""></a>ax1.set_ylabel(<span class="st">'Purchase Decision (0=No, 1=Yes)'</span>)</span>
<span id="cb1-108"><a href=""></a>ax1.set_title(<span class="st">'Linear Regression for Classification</span><span class="ch">\n</span><span class="st">(Problems: Unbounded Predictions)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb1-109"><a href=""></a>ax1.legend()</span>
<span id="cb1-110"><a href=""></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb1-111"><a href=""></a>ax1.set_ylim(<span class="op">-</span><span class="fl">0.3</span>, <span class="fl">1.3</span>)</span>
<span id="cb1-112"><a href=""></a></span>
<span id="cb1-113"><a href=""></a><span class="co"># Show the sigmoid function as solution</span></span>
<span id="cb1-114"><a href=""></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb1-115"><a href=""></a><span class="co"># Create sigmoid curve</span></span>
<span id="cb1-116"><a href=""></a><span class="kw">def</span> sigmoid(x):</span>
<span id="cb1-117"><a href=""></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>x))</span>
<span id="cb1-118"><a href=""></a></span>
<span id="cb1-119"><a href=""></a>z_values <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">100</span>)</span>
<span id="cb1-120"><a href=""></a>sigmoid_values <span class="op">=</span> sigmoid(z_values)</span>
<span id="cb1-121"><a href=""></a></span>
<span id="cb1-122"><a href=""></a>ax2.plot(z_values, sigmoid_values, color<span class="op">=</span><span class="st">'green'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'Sigmoid Function'</span>)</span>
<span id="cb1-123"><a href=""></a>ax2.axhline(y<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Decision Threshold (0.5)'</span>)</span>
<span id="cb1-124"><a href=""></a>ax2.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb1-125"><a href=""></a>ax2.axhline(y<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb1-126"><a href=""></a></span>
<span id="cb1-127"><a href=""></a>ax2.set_xlabel(<span class="st">'Linear Combination (z = β₀ + β₁X)'</span>)</span>
<span id="cb1-128"><a href=""></a>ax2.set_ylabel(<span class="st">'Probability P(Y=1)'</span>)</span>
<span id="cb1-129"><a href=""></a>ax2.set_title(<span class="st">'Sigmoid Function</span><span class="ch">\n</span><span class="st">(Solution: Bounded 0-1 Probabilities)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb1-130"><a href=""></a>ax2.legend()</span>
<span id="cb1-131"><a href=""></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb1-132"><a href=""></a>ax2.set_ylim(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.1</span>)</span>
<span id="cb1-133"><a href=""></a></span>
<span id="cb1-134"><a href=""></a>plt.tight_layout()</span>
<span id="cb1-135"><a href=""></a>plt.show()</span>
<span id="cb1-136"><a href=""></a></span>
<span id="cb1-137"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">SIGMOID FUNCTION ADVANTAGES:"</span>)</span>
<span id="cb1-138"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">35</span>)</span>
<span id="cb1-139"><a href=""></a><span class="bu">print</span>(<span class="st">"  ✓ Always produces probabilities between 0 and 1"</span>)</span>
<span id="cb1-140"><a href=""></a><span class="bu">print</span>(<span class="st">"  ✓ S-shaped curve appropriate for binary outcomes"</span>)</span>
<span id="cb1-141"><a href=""></a><span class="bu">print</span>(<span class="st">"  ✓ Smooth transitions (no sharp cutoffs)"</span>)</span>
<span id="cb1-142"><a href=""></a><span class="bu">print</span>(<span class="st">"  ✓ Asymptotic behavior (approaches 0 and 1)"</span>)</span>
<span id="cb1-143"><a href=""></a><span class="bu">print</span>(<span class="st">"  ✓ Interpretable as log-odds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WHY LINEAR REGRESSION FAILS FOR CLASSIFICATION
=======================================================
Customer Purchase Dataset:
==============================
Total Customers: 200
Purchases: 91 (45.5%)
Non-Purchases: 109

LINEAR REGRESSION ATTEMPT:
==============================
Linear Regression Results:
  Coefficient: -0.0058
  Intercept: 0.7340
  Prediction Range: [0.274, 0.627]

Problems with Linear Regression:
  ✗ Predictions are bounded, but still problematic for probability interpretation
  ✗ No natural threshold for classification
  ✗ Assumes linear relationship between features and probability
  ✗ Poor extrapolation behavior</code></pre>
</div>

<div class="cell-output cell-output-stdout">
<pre><code>
SIGMOID FUNCTION ADVANTAGES:
===================================
  ✓ Always produces probabilities between 0 and 1
  ✓ S-shaped curve appropriate for binary outcomes
  ✓ Smooth transitions (no sharp cutoffs)
  ✓ Asymptotic behavior (approaches 0 and 1)
  ✓ Interpretable as log-odds</code></pre>
</div>
</div>
<img data-src="Week12-lecture-slides_files/figure-revealjs/cell-2-output-2.png" class="r-stretch"></section>
<section class="slide level2">

</section></section>
<section>
<section id="part-2-logistic-regression-implementation" class="title-slide slide level1 smaller center">
<h1>Part 2: Logistic Regression Implementation</h1>

</section>
<section id="building-binary-classification-models" class="slide level2">
<h2>Building Binary Classification Models</h2>
<div id="2adf31e2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href=""></a><span class="bu">print</span>(<span class="st">"LOGISTIC REGRESSION IMPLEMENTATION"</span>)</span>
<span id="cb4-2"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb4-3"><a href=""></a></span>
<span id="cb4-4"><a href=""></a><span class="co"># Enhanced customer dataset for logistic regression</span></span>
<span id="cb4-5"><a href=""></a><span class="co"># Add more features for realistic business scenario</span></span>
<span id="cb4-6"><a href=""></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb4-7"><a href=""></a>n_customers <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb4-8"><a href=""></a></span>
<span id="cb4-9"><a href=""></a><span class="co"># Generate comprehensive customer features</span></span>
<span id="cb4-10"><a href=""></a>customer_features <span class="op">=</span> pd.DataFrame({</span>
<span id="cb4-11"><a href=""></a>    <span class="st">'Age'</span>: np.random.uniform(<span class="dv">18</span>, <span class="dv">80</span>, n_customers),</span>
<span id="cb4-12"><a href=""></a>    <span class="st">'Income'</span>: np.random.uniform(<span class="dv">25000</span>, <span class="dv">150000</span>, n_customers),</span>
<span id="cb4-13"><a href=""></a>    <span class="st">'Previous_Purchases'</span>: np.random.poisson(<span class="dv">3</span>, n_customers),</span>
<span id="cb4-14"><a href=""></a>    <span class="st">'Website_Visits'</span>: np.random.uniform(<span class="dv">1</span>, <span class="dv">50</span>, n_customers),</span>
<span id="cb4-15"><a href=""></a>    <span class="st">'Time_as_Customer'</span>: np.random.uniform(<span class="dv">0</span>, <span class="dv">10</span>, n_customers)</span>
<span id="cb4-16"><a href=""></a>})</span>
<span id="cb4-17"><a href=""></a></span>
<span id="cb4-18"><a href=""></a><span class="co"># Create realistic purchase probability with multiple factors</span></span>
<span id="cb4-19"><a href=""></a><span class="co"># Logistic regression form: log-odds = β₀ + β₁X₁ + β₂X₂ + ...</span></span>
<span id="cb4-20"><a href=""></a>log_odds <span class="op">=</span> (<span class="op">-</span><span class="fl">3.0</span> <span class="op">+</span> </span>
<span id="cb4-21"><a href=""></a>           <span class="fl">0.02</span> <span class="op">*</span> customer_features[<span class="st">'Age'</span>] <span class="op">+</span>  <span class="co"># Older customers slightly more likely</span></span>
<span id="cb4-22"><a href=""></a>           <span class="fl">0.00003</span> <span class="op">*</span> customer_features[<span class="st">'Income'</span>] <span class="op">+</span>  <span class="co"># Higher income more likely</span></span>
<span id="cb4-23"><a href=""></a>           <span class="fl">0.4</span> <span class="op">*</span> customer_features[<span class="st">'Previous_Purchases'</span>] <span class="op">+</span>  <span class="co"># Loyalty effect</span></span>
<span id="cb4-24"><a href=""></a>           <span class="fl">0.05</span> <span class="op">*</span> customer_features[<span class="st">'Website_Visits'</span>] <span class="op">+</span>  <span class="co"># Engagement effect</span></span>
<span id="cb4-25"><a href=""></a>           <span class="fl">0.2</span> <span class="op">*</span> customer_features[<span class="st">'Time_as_Customer'</span>] <span class="op">+</span>  <span class="co"># Tenure effect</span></span>
<span id="cb4-26"><a href=""></a>           np.random.normal(<span class="dv">0</span>, <span class="fl">0.5</span>, n_customers))  <span class="co"># Random noise</span></span>
<span id="cb4-27"><a href=""></a></span>
<span id="cb4-28"><a href=""></a><span class="co"># Convert to probabilities using sigmoid</span></span>
<span id="cb4-29"><a href=""></a>purchase_probabilities <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>log_odds))</span>
<span id="cb4-30"><a href=""></a>purchase_decisions <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, purchase_probabilities, n_customers)</span>
<span id="cb4-31"><a href=""></a></span>
<span id="cb4-32"><a href=""></a><span class="co"># Add target variable</span></span>
<span id="cb4-33"><a href=""></a>customer_features[<span class="st">'Purchase_Probability_True'</span>] <span class="op">=</span> purchase_probabilities</span>
<span id="cb4-34"><a href=""></a>customer_features[<span class="st">'Purchased'</span>] <span class="op">=</span> purchase_decisions</span>
<span id="cb4-35"><a href=""></a></span>
<span id="cb4-36"><a href=""></a><span class="bu">print</span>(<span class="st">"Enhanced Customer Dataset:"</span>)</span>
<span id="cb4-37"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb4-38"><a href=""></a><span class="bu">print</span>(customer_features.describe().<span class="bu">round</span>(<span class="dv">2</span>))</span>
<span id="cb4-39"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Purchase Rate: </span><span class="sc">{</span>purchase_decisions<span class="sc">.</span>mean()<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb4-40"><a href=""></a></span>
<span id="cb4-41"><a href=""></a><span class="co"># Prepare features and target</span></span>
<span id="cb4-42"><a href=""></a>feature_columns <span class="op">=</span> [<span class="st">'Age'</span>, <span class="st">'Income'</span>, <span class="st">'Previous_Purchases'</span>, <span class="st">'Website_Visits'</span>, <span class="st">'Time_as_Customer'</span>]</span>
<span id="cb4-43"><a href=""></a>X <span class="op">=</span> customer_features[feature_columns]</span>
<span id="cb4-44"><a href=""></a>y <span class="op">=</span> customer_features[<span class="st">'Purchased'</span>]</span>
<span id="cb4-45"><a href=""></a></span>
<span id="cb4-46"><a href=""></a><span class="co"># Train-test split</span></span>
<span id="cb4-47"><a href=""></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y)</span>
<span id="cb4-48"><a href=""></a></span>
<span id="cb4-49"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Train-Test Split:"</span>)</span>
<span id="cb4-50"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  Training: </span><span class="sc">{</span><span class="bu">len</span>(X_train)<span class="sc">}</span><span class="ss"> customers"</span>)</span>
<span id="cb4-51"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  Test: </span><span class="sc">{</span><span class="bu">len</span>(X_test)<span class="sc">}</span><span class="ss"> customers"</span>)</span>
<span id="cb4-52"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  Training Purchase Rate: </span><span class="sc">{</span>y_train<span class="sc">.</span>mean()<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb4-53"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  Test Purchase Rate: </span><span class="sc">{</span>y_test<span class="sc">.</span>mean()<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb4-54"><a href=""></a></span>
<span id="cb4-55"><a href=""></a><span class="co"># Train logistic regression model</span></span>
<span id="cb4-56"><a href=""></a>logistic_model <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb4-57"><a href=""></a>logistic_model.fit(X_train, y_train)</span>
<span id="cb4-58"><a href=""></a></span>
<span id="cb4-59"><a href=""></a><span class="co"># Extract model parameters</span></span>
<span id="cb4-60"><a href=""></a>intercept <span class="op">=</span> logistic_model.intercept_[<span class="dv">0</span>]</span>
<span id="cb4-61"><a href=""></a>coefficients <span class="op">=</span> logistic_model.coef_[<span class="dv">0</span>]</span>
<span id="cb4-62"><a href=""></a></span>
<span id="cb4-63"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Logistic Regression Coefficients:"</span>)</span>
<span id="cb4-64"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  Intercept: </span><span class="sc">{</span>intercept<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb4-65"><a href=""></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Feature Coefficients (log-odds):"</span>)</span>
<span id="cb4-66"><a href=""></a><span class="cf">for</span> feature, coef <span class="kw">in</span> <span class="bu">zip</span>(feature_columns, coefficients):</span>
<span id="cb4-67"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>coef<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb4-68"><a href=""></a></span>
<span id="cb4-69"><a href=""></a><span class="co"># Convert to odds ratios for business interpretation</span></span>
<span id="cb4-70"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Odds Ratios (more interpretable):"</span>)</span>
<span id="cb4-71"><a href=""></a><span class="cf">for</span> feature, coef <span class="kw">in</span> <span class="bu">zip</span>(feature_columns, coefficients):</span>
<span id="cb4-72"><a href=""></a>    odds_ratio <span class="op">=</span> np.exp(coef)</span>
<span id="cb4-73"><a href=""></a>    <span class="cf">if</span> odds_ratio <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb4-74"><a href=""></a>        effect <span class="op">=</span> <span class="ss">f"increases odds by </span><span class="sc">{</span>(odds_ratio<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span></span>
<span id="cb4-75"><a href=""></a>    <span class="cf">else</span>:</span>
<span id="cb4-76"><a href=""></a>        effect <span class="op">=</span> <span class="ss">f"decreases odds by </span><span class="sc">{</span>(<span class="dv">1</span><span class="op">-</span>odds_ratio)<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span></span>
<span id="cb4-77"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>odds_ratio<span class="sc">:.3f}</span><span class="ss"> - Each unit increase </span><span class="sc">{</span>effect<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-78"><a href=""></a></span>
<span id="cb4-79"><a href=""></a><span class="co"># Make predictions</span></span>
<span id="cb4-80"><a href=""></a><span class="co"># Class predictions (0 or 1)</span></span>
<span id="cb4-81"><a href=""></a>y_pred_class <span class="op">=</span> logistic_model.predict(X_test)</span>
<span id="cb4-82"><a href=""></a></span>
<span id="cb4-83"><a href=""></a><span class="co"># Probability predictions</span></span>
<span id="cb4-84"><a href=""></a>y_pred_proba <span class="op">=</span> logistic_model.predict_proba(X_test)</span>
<span id="cb4-85"><a href=""></a>y_pred_proba_positive <span class="op">=</span> y_pred_proba[:, <span class="dv">1</span>]  <span class="co"># Probability of class 1 (Purchase)</span></span>
<span id="cb4-86"><a href=""></a></span>
<span id="cb4-87"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Prediction Examples:"</span>)</span>
<span id="cb4-88"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">20</span>)</span>
<span id="cb4-89"><a href=""></a><span class="bu">print</span>(<span class="st">"Sample of first 10 test predictions:"</span>)</span>
<span id="cb4-90"><a href=""></a><span class="bu">print</span>(<span class="st">"Customer | Actual | Pred_Class | Pred_Prob"</span>)</span>
<span id="cb4-91"><a href=""></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">45</span>)</span>
<span id="cb4-92"><a href=""></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb4-93"><a href=""></a>    actual <span class="op">=</span> y_test.iloc[i]</span>
<span id="cb4-94"><a href=""></a>    pred_class <span class="op">=</span> y_pred_class[i]</span>
<span id="cb4-95"><a href=""></a>    pred_prob <span class="op">=</span> y_pred_proba_positive[i]</span>
<span id="cb4-96"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">:8}</span><span class="ss"> | </span><span class="sc">{</span>actual<span class="sc">:6}</span><span class="ss"> | </span><span class="sc">{</span>pred_class<span class="sc">:10}</span><span class="ss"> | </span><span class="sc">{</span>pred_prob<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb4-97"><a href=""></a></span>
<span id="cb4-98"><a href=""></a><span class="co"># Business interpretation examples</span></span>
<span id="cb4-99"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">BUSINESS INTERPRETATION EXAMPLES:"</span>)</span>
<span id="cb4-100"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb4-101"><a href=""></a></span>
<span id="cb4-102"><a href=""></a><span class="co"># Create example customer profiles</span></span>
<span id="cb4-103"><a href=""></a>example_customers <span class="op">=</span> pd.DataFrame({</span>
<span id="cb4-104"><a href=""></a>    <span class="st">'Age'</span>: [<span class="dv">25</span>, <span class="dv">45</span>, <span class="dv">65</span>],</span>
<span id="cb4-105"><a href=""></a>    <span class="st">'Income'</span>: [<span class="dv">40000</span>, <span class="dv">80000</span>, <span class="dv">120000</span>],</span>
<span id="cb4-106"><a href=""></a>    <span class="st">'Previous_Purchases'</span>: [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">8</span>],</span>
<span id="cb4-107"><a href=""></a>    <span class="st">'Website_Visits'</span>: [<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">30</span>],</span>
<span id="cb4-108"><a href=""></a>    <span class="st">'Time_as_Customer'</span>: [<span class="fl">0.5</span>, <span class="dv">3</span>, <span class="dv">7</span>],</span>
<span id="cb4-109"><a href=""></a>    <span class="st">'Profile'</span>: [<span class="st">'Young New Customer'</span>, <span class="st">'Middle-aged Regular'</span>, <span class="st">'Senior Loyal Customer'</span>]</span>
<span id="cb4-110"><a href=""></a>})</span>
<span id="cb4-111"><a href=""></a></span>
<span id="cb4-112"><a href=""></a>example_probabilities <span class="op">=</span> logistic_model.predict_proba(example_customers[feature_columns])[:, <span class="dv">1</span>]</span>
<span id="cb4-113"><a href=""></a>example_classes <span class="op">=</span> logistic_model.predict(example_customers[feature_columns])</span>
<span id="cb4-114"><a href=""></a></span>
<span id="cb4-115"><a href=""></a><span class="cf">for</span> i, (_, customer) <span class="kw">in</span> <span class="bu">enumerate</span>(example_customers.iterrows()):</span>
<span id="cb4-116"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>customer[<span class="st">'Profile'</span>]<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb4-117"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  Age: </span><span class="sc">{</span>customer[<span class="st">'Age'</span>]<span class="sc">}</span><span class="ss">, Income: $</span><span class="sc">{</span>customer[<span class="st">'Income'</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb4-118"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  Previous Purchases: </span><span class="sc">{</span>customer[<span class="st">'Previous_Purchases'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-119"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  Website Visits: </span><span class="sc">{</span>customer[<span class="st">'Website_Visits'</span>]<span class="sc">}</span><span class="ss">, Tenure: </span><span class="sc">{</span>customer[<span class="st">'Time_as_Customer'</span>]<span class="sc">:.1f}</span><span class="ss"> years"</span>)</span>
<span id="cb4-120"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  → Purchase Probability: </span><span class="sc">{</span>example_probabilities[i]<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb4-121"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  → Classification: </span><span class="sc">{</span><span class="st">'Will Purchase'</span> <span class="cf">if</span> example_classes[i] <span class="cf">else</span> <span class="st">'Will Not Purchase'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-122"><a href=""></a></span>
<span id="cb4-123"><a href=""></a><span class="co"># Visualize model performance</span></span>
<span id="cb4-124"><a href=""></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">12</span>))</span>
<span id="cb4-125"><a href=""></a></span>
<span id="cb4-126"><a href=""></a><span class="co"># 1. Probability distribution by actual class</span></span>
<span id="cb4-127"><a href=""></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb4-128"><a href=""></a>purchased <span class="op">=</span> y_pred_proba_positive[y_test <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb4-129"><a href=""></a>not_purchased <span class="op">=</span> y_pred_proba_positive[y_test <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb4-130"><a href=""></a></span>
<span id="cb4-131"><a href=""></a>ax1.hist(not_purchased, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Did Not Purchase'</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-132"><a href=""></a>ax1.hist(purchased, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'green'</span>, label<span class="op">=</span><span class="st">'Purchased'</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-133"><a href=""></a>ax1.axvline(<span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Decision Threshold'</span>)</span>
<span id="cb4-134"><a href=""></a></span>
<span id="cb4-135"><a href=""></a>ax1.set_xlabel(<span class="st">'Predicted Purchase Probability'</span>)</span>
<span id="cb4-136"><a href=""></a>ax1.set_ylabel(<span class="st">'Density'</span>)</span>
<span id="cb4-137"><a href=""></a>ax1.set_title(<span class="st">'Probability Distribution by Actual Class'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-138"><a href=""></a>ax1.legend()</span>
<span id="cb4-139"><a href=""></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb4-140"><a href=""></a></span>
<span id="cb4-141"><a href=""></a><span class="co"># 2. Feature importance (coefficient magnitudes)</span></span>
<span id="cb4-142"><a href=""></a>ax2 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb4-143"><a href=""></a>coef_abs <span class="op">=</span> np.<span class="bu">abs</span>(coefficients)</span>
<span id="cb4-144"><a href=""></a>colors <span class="op">=</span> [<span class="st">'green'</span> <span class="cf">if</span> coef <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'red'</span> <span class="cf">for</span> coef <span class="kw">in</span> coefficients]</span>
<span id="cb4-145"><a href=""></a>bars <span class="op">=</span> ax2.barh(<span class="bu">range</span>(<span class="bu">len</span>(feature_columns)), coef_abs, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb4-146"><a href=""></a>ax2.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(feature_columns)))</span>
<span id="cb4-147"><a href=""></a>ax2.set_yticklabels([col.replace(<span class="st">'_'</span>, <span class="st">' '</span>) <span class="cf">for</span> col <span class="kw">in</span> feature_columns])</span>
<span id="cb4-148"><a href=""></a>ax2.set_xlabel(<span class="st">'Absolute Coefficient Value'</span>)</span>
<span id="cb4-149"><a href=""></a>ax2.set_title(<span class="st">'Feature Importance</span><span class="ch">\n</span><span class="st">(Green=Increases Purchase, Red=Decreases)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-150"><a href=""></a>ax2.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb4-151"><a href=""></a></span>
<span id="cb4-152"><a href=""></a><span class="co"># 3. Sigmoid curve with data points</span></span>
<span id="cb4-153"><a href=""></a>ax3 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb4-154"><a href=""></a></span>
<span id="cb4-155"><a href=""></a><span class="co"># Use one feature for visualization (Income)</span></span>
<span id="cb4-156"><a href=""></a>income_sorted_idx <span class="op">=</span> np.argsort(X_test[<span class="st">'Income'</span>])</span>
<span id="cb4-157"><a href=""></a>income_sorted <span class="op">=</span> X_test[<span class="st">'Income'</span>].iloc[income_sorted_idx]</span>
<span id="cb4-158"><a href=""></a>prob_sorted <span class="op">=</span> y_pred_proba_positive[income_sorted_idx]</span>
<span id="cb4-159"><a href=""></a></span>
<span id="cb4-160"><a href=""></a>ax3.scatter(X_test[<span class="st">'Income'</span>], y_test, alpha<span class="op">=</span><span class="fl">0.3</span>, s<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Actual Purchases'</span>)</span>
<span id="cb4-161"><a href=""></a>ax3.plot(income_sorted, prob_sorted, color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Predicted Probability'</span>)</span>
<span id="cb4-162"><a href=""></a>ax3.axhline(y<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Decision Threshold'</span>)</span>
<span id="cb4-163"><a href=""></a></span>
<span id="cb4-164"><a href=""></a>ax3.set_xlabel(<span class="st">'Income ($)'</span>)</span>
<span id="cb4-165"><a href=""></a>ax3.set_ylabel(<span class="st">'Purchase Probability'</span>)</span>
<span id="cb4-166"><a href=""></a>ax3.set_title(<span class="st">'Logistic Curve: Income vs Purchase Probability'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-167"><a href=""></a>ax3.legend()</span>
<span id="cb4-168"><a href=""></a>ax3.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb4-169"><a href=""></a></span>
<span id="cb4-170"><a href=""></a><span class="co"># 4. ROC-like visualization</span></span>
<span id="cb4-171"><a href=""></a>ax4 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb4-172"><a href=""></a></span>
<span id="cb4-173"><a href=""></a><span class="co"># Sort by predicted probability</span></span>
<span id="cb4-174"><a href=""></a>sorted_indices <span class="op">=</span> np.argsort(y_pred_proba_positive)[::<span class="op">-</span><span class="dv">1</span>]  <span class="co"># Descending order</span></span>
<span id="cb4-175"><a href=""></a>cumulative_positives <span class="op">=</span> np.cumsum(y_test.iloc[sorted_indices])</span>
<span id="cb4-176"><a href=""></a>total_positives <span class="op">=</span> cumulative_positives.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb4-177"><a href=""></a></span>
<span id="cb4-178"><a href=""></a><span class="co"># Calculate precision at different thresholds</span></span>
<span id="cb4-179"><a href=""></a>precision_curve <span class="op">=</span> cumulative_positives <span class="op">/</span> np.arange(<span class="dv">1</span>, <span class="bu">len</span>(sorted_indices) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb4-180"><a href=""></a>recall_curve <span class="op">=</span> cumulative_positives <span class="op">/</span> total_positives</span>
<span id="cb4-181"><a href=""></a></span>
<span id="cb4-182"><a href=""></a>ax4.plot(recall_curve, precision_curve, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb4-183"><a href=""></a>ax4.set_xlabel(<span class="st">'Recall (True Positive Rate)'</span>)</span>
<span id="cb4-184"><a href=""></a>ax4.set_ylabel(<span class="st">'Precision (Positive Predictive Value)'</span>)</span>
<span id="cb4-185"><a href=""></a>ax4.set_title(<span class="st">'Precision-Recall Curve'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-186"><a href=""></a>ax4.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb4-187"><a href=""></a>ax4.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb4-188"><a href=""></a>ax4.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb4-189"><a href=""></a></span>
<span id="cb4-190"><a href=""></a>plt.tight_layout()</span>
<span id="cb4-191"><a href=""></a>plt.show()</span>
<span id="cb4-192"><a href=""></a></span>
<span id="cb4-193"><a href=""></a><span class="co"># Model evaluation summary</span></span>
<span id="cb4-194"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">MODEL EVALUATION PREVIEW:"</span>)</span>
<span id="cb4-195"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb4-196"><a href=""></a>accuracy <span class="op">=</span> accuracy_score(y_test, y_pred_class)</span>
<span id="cb4-197"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.3f}</span><span class="ss"> (</span><span class="sc">{</span>accuracy<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb4-198"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Baseline (always predict majority): </span><span class="sc">{</span><span class="bu">max</span>(y_test.mean(), <span class="dv">1</span><span class="op">-</span>y_test.mean())<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb4-199"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Improvement over baseline: </span><span class="sc">{</span>accuracy <span class="op">-</span> <span class="bu">max</span>(y_test.mean(), <span class="dv">1</span><span class="op">-</span>y_test.mean())<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb4-200"><a href=""></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">(Detailed evaluation metrics coming next...)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LOGISTIC REGRESSION IMPLEMENTATION
========================================
Enhanced Customer Dataset:
==============================
          Age     Income  Previous_Purchases  Website_Visits  \
count  500.00     500.00              500.00          500.00   
mean    48.91   85243.92                2.99           25.35   
std     18.52   35686.68                1.74           13.86   
min     18.31   25579.00                0.00            1.10   
25%     32.96   53637.41                2.00           13.27   
50%     49.82   83977.70                3.00           26.40   
75%     64.88  115792.10                4.00           36.45   
max     79.56  149964.71                8.00           49.95   

       Time_as_Customer  Purchase_Probability_True  Purchased  
count            500.00                     500.00     500.00  
mean               4.85                       0.94       0.95  
std                2.91                       0.10       0.21  
min                0.01                       0.27       0.00  
25%                2.31                       0.95       1.00  
50%                4.62                       0.98       1.00  
75%                7.52                       0.99       1.00  
max               10.00                       1.00       1.00  

Purchase Rate: 95.4%

Train-Test Split:
  Training: 375 customers
  Test: 125 customers
  Training Purchase Rate: 95.5%
  Test Purchase Rate: 95.2%

Logistic Regression Coefficients:
  Intercept: -0.0004

Feature Coefficients (log-odds):
  Age: -0.016196
  Income: 0.000016
  Previous_Purchases: 0.163816
  Website_Visits: 0.052783
  Time_as_Customer: 0.305045

Odds Ratios (more interpretable):
  Age: 0.984 - Each unit increase decreases odds by 1.6%
  Income: 1.000 - Each unit increase increases odds by 0.0%
  Previous_Purchases: 1.178 - Each unit increase increases odds by 17.8%
  Website_Visits: 1.054 - Each unit increase increases odds by 5.4%
  Time_as_Customer: 1.357 - Each unit increase increases odds by 35.7%

Prediction Examples:
====================
Sample of first 10 test predictions:
Customer | Actual | Pred_Class | Pred_Prob
---------------------------------------------
       1 |      1 |          1 | 0.997
       2 |      1 |          1 | 0.970
       3 |      1 |          1 | 0.994
       4 |      1 |          1 | 0.981
       5 |      1 |          1 | 0.967
       6 |      1 |          1 | 0.929
       7 |      1 |          1 | 0.975
       8 |      1 |          1 | 0.975
       9 |      1 |          1 | 0.933
      10 |      1 |          1 | 0.988

BUSINESS INTERPRETATION EXAMPLES:
========================================

Young New Customer:
  Age: 25, Income: $40,000
  Previous Purchases: 0
  Website Visits: 5, Tenure: 0.5 years
  → Purchase Probability: 66.1%
  → Classification: Will Purchase

Middle-aged Regular:
  Age: 45, Income: $80,000
  Previous Purchases: 2
  Website Visits: 15, Tenure: 3.0 years
  → Purchase Probability: 93.2%
  → Classification: Will Purchase

Senior Loyal Customer:
  Age: 65, Income: $120,000
  Previous Purchases: 8
  Website Visits: 30, Tenure: 7.0 years
  → Purchase Probability: 99.7%
  → Classification: Will Purchase</code></pre>
</div>

<div class="cell-output cell-output-stdout">
<pre><code>
MODEL EVALUATION PREVIEW:
==============================
Accuracy: 0.952 (95.2%)
Baseline (always predict majority): 0.952
Improvement over baseline: 0.000

(Detailed evaluation metrics coming next...)</code></pre>
</div>
</div>
<img data-src="Week12-lecture-slides_files/figure-revealjs/cell-3-output-2.png" class="r-stretch"></section>
<section class="slide level2">

</section></section>
<section>
<section id="part-3-classification-metrics-and-evaluation" class="title-slide slide level1 smaller center">
<h1>Part 3: Classification Metrics and Evaluation</h1>

</section>
<section id="understanding-model-performance" class="slide level2">
<h2>Understanding Model Performance</h2>
<div id="1287c8e0" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href=""></a><span class="bu">print</span>(<span class="st">"COMPREHENSIVE CLASSIFICATION EVALUATION"</span>)</span>
<span id="cb7-2"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">45</span>)</span>
<span id="cb7-3"><a href=""></a></span>
<span id="cb7-4"><a href=""></a><span class="co"># Calculate all classification metrics</span></span>
<span id="cb7-5"><a href=""></a>accuracy <span class="op">=</span> accuracy_score(y_test, y_pred_class)</span>
<span id="cb7-6"><a href=""></a>precision <span class="op">=</span> precision_score(y_test, y_pred_class)</span>
<span id="cb7-7"><a href=""></a>recall <span class="op">=</span> recall_score(y_test, y_pred_class)</span>
<span id="cb7-8"><a href=""></a>f1 <span class="op">=</span> f1_score(y_test, y_pred_class)</span>
<span id="cb7-9"><a href=""></a></span>
<span id="cb7-10"><a href=""></a><span class="co"># Confusion Matrix</span></span>
<span id="cb7-11"><a href=""></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred_class)</span>
<span id="cb7-12"><a href=""></a>tn, fp, fn, tp <span class="op">=</span> cm.ravel()</span>
<span id="cb7-13"><a href=""></a></span>
<span id="cb7-14"><a href=""></a><span class="bu">print</span>(<span class="st">"CONFUSION MATRIX ANALYSIS:"</span>)</span>
<span id="cb7-15"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb7-16"><a href=""></a><span class="bu">print</span>(<span class="st">"Confusion Matrix:"</span>)</span>
<span id="cb7-17"><a href=""></a><span class="bu">print</span>(<span class="ss">f"                Predicted"</span>)</span>
<span id="cb7-18"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Actual    No Purchase  Purchase"</span>)</span>
<span id="cb7-19"><a href=""></a><span class="bu">print</span>(<span class="ss">f"No Purchase    </span><span class="sc">{</span>tn<span class="sc">:3d}</span><span class="ss">       </span><span class="sc">{</span>fp<span class="sc">:3d}</span><span class="ss">"</span>)</span>
<span id="cb7-20"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Purchase       </span><span class="sc">{</span>fn<span class="sc">:3d}</span><span class="ss">       </span><span class="sc">{</span>tp<span class="sc">:3d}</span><span class="ss">"</span>)</span>
<span id="cb7-21"><a href=""></a></span>
<span id="cb7-22"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Confusion Matrix Components:"</span>)</span>
<span id="cb7-23"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  True Negatives (TN):  </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> - Correctly predicted no purchase"</span>)</span>
<span id="cb7-24"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  False Positives (FP): </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> - Incorrectly predicted purchase"</span>) </span>
<span id="cb7-25"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  False Negatives (FN): </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> - Missed actual purchases"</span>)</span>
<span id="cb7-26"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  True Positives (TP):  </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> - Correctly predicted purchases"</span>)</span>
<span id="cb7-27"><a href=""></a></span>
<span id="cb7-28"><a href=""></a><span class="co"># Calculate metrics manually to show formulas</span></span>
<span id="cb7-29"><a href=""></a>accuracy_manual <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn)</span>
<span id="cb7-30"><a href=""></a>precision_manual <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb7-31"><a href=""></a>recall_manual <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb7-32"><a href=""></a>f1_manual <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (precision_manual <span class="op">*</span> recall_manual) <span class="op">/</span> (precision_manual <span class="op">+</span> recall_manual) <span class="cf">if</span> (precision_manual <span class="op">+</span> recall_manual) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb7-33"><a href=""></a></span>
<span id="cb7-34"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">CLASSIFICATION METRICS:"</span>)</span>
<span id="cb7-35"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">25</span>)</span>
<span id="cb7-36"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Accuracy:  </span><span class="sc">{</span>accuracy<span class="sc">:.3f}</span><span class="ss"> = (TP + TN) / Total = (</span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> + </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss">) / </span><span class="sc">{</span><span class="bu">len</span>(y_test)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-37"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Precision: </span><span class="sc">{</span>precision<span class="sc">:.3f}</span><span class="ss"> = TP / (TP + FP) = </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> / (</span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> + </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb7-38"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Recall:    </span><span class="sc">{</span>recall<span class="sc">:.3f}</span><span class="ss"> = TP / (TP + FN) = </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> / (</span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> + </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb7-39"><a href=""></a><span class="bu">print</span>(<span class="ss">f"F1-Score:  </span><span class="sc">{</span>f1<span class="sc">:.3f}</span><span class="ss"> = 2 × (Precision × Recall) / (Precision + Recall)"</span>)</span>
<span id="cb7-40"><a href=""></a></span>
<span id="cb7-41"><a href=""></a><span class="co"># Business interpretation of metrics</span></span>
<span id="cb7-42"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">BUSINESS INTERPRETATION:"</span>)</span>
<span id="cb7-43"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">28</span>)</span>
<span id="cb7-44"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Accuracy (</span><span class="sc">{</span>accuracy<span class="sc">:.1%}</span><span class="ss">):"</span>)</span>
<span id="cb7-45"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Overall correctness of predictions"</span>)</span>
<span id="cb7-46"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • </span><span class="sc">{</span>accuracy<span class="op">*</span><span class="bu">len</span>(y_test)<span class="sc">:.0f}</span><span class="ss"> out of </span><span class="sc">{</span><span class="bu">len</span>(y_test)<span class="sc">}</span><span class="ss"> customers correctly classified"</span>)</span>
<span id="cb7-47"><a href=""></a></span>
<span id="cb7-48"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Precision (</span><span class="sc">{</span>precision<span class="sc">:.1%}</span><span class="ss">):"</span>)</span>
<span id="cb7-49"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Of customers predicted to purchase, </span><span class="sc">{</span>precision<span class="sc">:.1%}</span><span class="ss"> actually did"</span>)</span>
<span id="cb7-50"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Lower precision = more wasted marketing spend on unlikely buyers"</span>)</span>
<span id="cb7-51"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Cost of false positives: unnecessary marketing costs"</span>)</span>
<span id="cb7-52"><a href=""></a></span>
<span id="cb7-53"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Recall (</span><span class="sc">{</span>recall<span class="sc">:.1%}</span><span class="ss">):"</span>)</span>
<span id="cb7-54"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Of customers who actually purchased, </span><span class="sc">{</span>recall<span class="sc">:.1%}</span><span class="ss"> were identified"</span>)</span>
<span id="cb7-55"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Lower recall = missed sales opportunities"</span>)</span>
<span id="cb7-56"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Cost of false negatives: lost revenue from missed customers"</span>)</span>
<span id="cb7-57"><a href=""></a></span>
<span id="cb7-58"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">F1-Score (</span><span class="sc">{</span>f1<span class="sc">:.1%}</span><span class="ss">):"</span>)</span>
<span id="cb7-59"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Balanced measure when both precision and recall matter"</span>)</span>
<span id="cb7-60"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Harmonic mean emphasizes lower values"</span>)</span>
<span id="cb7-61"><a href=""></a></span>
<span id="cb7-62"><a href=""></a><span class="co"># Business scenario analysis</span></span>
<span id="cb7-63"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">BUSINESS SCENARIO ANALYSIS:"</span>)</span>
<span id="cb7-64"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">35</span>)</span>
<span id="cb7-65"><a href=""></a></span>
<span id="cb7-66"><a href=""></a><span class="co"># Calculate business impact</span></span>
<span id="cb7-67"><a href=""></a>avg_purchase_value <span class="op">=</span> <span class="dv">150</span>  <span class="co"># Assume $150 average purchase</span></span>
<span id="cb7-68"><a href=""></a>marketing_cost_per_customer <span class="op">=</span> <span class="dv">25</span>  <span class="co"># Assume $25 marketing cost per targeted customer</span></span>
<span id="cb7-69"><a href=""></a></span>
<span id="cb7-70"><a href=""></a><span class="co"># True Positives: Successful marketing (Revenue - Cost)</span></span>
<span id="cb7-71"><a href=""></a>tp_profit <span class="op">=</span> tp <span class="op">*</span> (avg_purchase_value <span class="op">-</span> marketing_cost_per_customer)</span>
<span id="cb7-72"><a href=""></a></span>
<span id="cb7-73"><a href=""></a><span class="co"># False Positives: Wasted marketing spend</span></span>
<span id="cb7-74"><a href=""></a>fp_loss <span class="op">=</span> fp <span class="op">*</span> marketing_cost_per_customer</span>
<span id="cb7-75"><a href=""></a></span>
<span id="cb7-76"><a href=""></a><span class="co"># False Negatives: Missed revenue (no marketing cost, but no revenue)</span></span>
<span id="cb7-77"><a href=""></a>fn_opportunity_cost <span class="op">=</span> fn <span class="op">*</span> avg_purchase_value</span>
<span id="cb7-78"><a href=""></a></span>
<span id="cb7-79"><a href=""></a><span class="co"># True Negatives: Correctly avoided marketing cost (savings)</span></span>
<span id="cb7-80"><a href=""></a>tn_savings <span class="op">=</span> tn <span class="op">*</span> marketing_cost_per_customer</span>
<span id="cb7-81"><a href=""></a></span>
<span id="cb7-82"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Business Impact Analysis (assuming $</span><span class="sc">{</span>avg_purchase_value<span class="sc">}</span><span class="ss"> avg purchase, $</span><span class="sc">{</span>marketing_cost_per_customer<span class="sc">}</span><span class="ss"> marketing cost):"</span>)</span>
<span id="cb7-83"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  True Positives:  $</span><span class="sc">{</span>tp_profit<span class="sc">:,}</span><span class="ss"> profit (</span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> successful campaigns)"</span>)</span>
<span id="cb7-84"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  False Positives: $</span><span class="sc">{</span>fp_loss<span class="sc">:,}</span><span class="ss"> wasted spend (</span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> failed campaigns)"</span>)</span>
<span id="cb7-85"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  False Negatives: $</span><span class="sc">{</span>fn_opportunity_cost<span class="sc">:,}</span><span class="ss"> missed revenue (</span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> lost opportunities)"</span>)</span>
<span id="cb7-86"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  True Negatives:  $</span><span class="sc">{</span>tn_savings<span class="sc">:,}</span><span class="ss"> saved costs (</span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> correctly avoided)"</span>)</span>
<span id="cb7-87"><a href=""></a></span>
<span id="cb7-88"><a href=""></a>net_benefit <span class="op">=</span> tp_profit <span class="op">-</span> fp_loss <span class="op">-</span> fn_opportunity_cost</span>
<span id="cb7-89"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Net Business Benefit: $</span><span class="sc">{</span>net_benefit<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb7-90"><a href=""></a></span>
<span id="cb7-91"><a href=""></a><span class="co"># Threshold analysis</span></span>
<span id="cb7-92"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">THRESHOLD ANALYSIS:"</span>)</span>
<span id="cb7-93"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">25</span>)</span>
<span id="cb7-94"><a href=""></a></span>
<span id="cb7-95"><a href=""></a>thresholds <span class="op">=</span> [<span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>]</span>
<span id="cb7-96"><a href=""></a>threshold_results <span class="op">=</span> []</span>
<span id="cb7-97"><a href=""></a></span>
<span id="cb7-98"><a href=""></a><span class="cf">for</span> threshold <span class="kw">in</span> thresholds:</span>
<span id="cb7-99"><a href=""></a>    <span class="co"># Apply threshold</span></span>
<span id="cb7-100"><a href=""></a>    y_pred_threshold <span class="op">=</span> (y_pred_proba_positive <span class="op">&gt;=</span> threshold).astype(<span class="bu">int</span>)</span>
<span id="cb7-101"><a href=""></a>    </span>
<span id="cb7-102"><a href=""></a>    <span class="co"># Calculate metrics</span></span>
<span id="cb7-103"><a href=""></a>    cm_thresh <span class="op">=</span> confusion_matrix(y_test, y_pred_threshold)</span>
<span id="cb7-104"><a href=""></a>    tn_t, fp_t, fn_t, tp_t <span class="op">=</span> cm_thresh.ravel()</span>
<span id="cb7-105"><a href=""></a>    </span>
<span id="cb7-106"><a href=""></a>    accuracy_t <span class="op">=</span> accuracy_score(y_test, y_pred_threshold)</span>
<span id="cb7-107"><a href=""></a>    precision_t <span class="op">=</span> precision_score(y_test, y_pred_threshold) <span class="cf">if</span> (tp_t <span class="op">+</span> fp_t) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb7-108"><a href=""></a>    recall_t <span class="op">=</span> recall_score(y_test, y_pred_threshold) <span class="cf">if</span> (tp_t <span class="op">+</span> fn_t) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb7-109"><a href=""></a>    </span>
<span id="cb7-110"><a href=""></a>    <span class="co"># Business impact</span></span>
<span id="cb7-111"><a href=""></a>    tp_profit_t <span class="op">=</span> tp_t <span class="op">*</span> (avg_purchase_value <span class="op">-</span> marketing_cost_per_customer)</span>
<span id="cb7-112"><a href=""></a>    fp_loss_t <span class="op">=</span> fp_t <span class="op">*</span> marketing_cost_per_customer</span>
<span id="cb7-113"><a href=""></a>    fn_opportunity_t <span class="op">=</span> fn_t <span class="op">*</span> avg_purchase_value</span>
<span id="cb7-114"><a href=""></a>    net_benefit_t <span class="op">=</span> tp_profit_t <span class="op">-</span> fp_loss_t <span class="op">-</span> fn_opportunity_t</span>
<span id="cb7-115"><a href=""></a>    </span>
<span id="cb7-116"><a href=""></a>    threshold_results.append({</span>
<span id="cb7-117"><a href=""></a>        <span class="st">'Threshold'</span>: threshold,</span>
<span id="cb7-118"><a href=""></a>        <span class="st">'Accuracy'</span>: accuracy_t,</span>
<span id="cb7-119"><a href=""></a>        <span class="st">'Precision'</span>: precision_t,</span>
<span id="cb7-120"><a href=""></a>        <span class="st">'Recall'</span>: recall_t,</span>
<span id="cb7-121"><a href=""></a>        <span class="st">'Net_Benefit'</span>: net_benefit_t,</span>
<span id="cb7-122"><a href=""></a>        <span class="st">'TP'</span>: tp_t, <span class="st">'FP'</span>: fp_t, <span class="st">'FN'</span>: fn_t, <span class="st">'TN'</span>: tn_t</span>
<span id="cb7-123"><a href=""></a>    })</span>
<span id="cb7-124"><a href=""></a></span>
<span id="cb7-125"><a href=""></a>threshold_df <span class="op">=</span> pd.DataFrame(threshold_results)</span>
<span id="cb7-126"><a href=""></a><span class="bu">print</span>(<span class="st">"Threshold Comparison:"</span>)</span>
<span id="cb7-127"><a href=""></a><span class="bu">print</span>(threshold_df[[<span class="st">'Threshold'</span>, <span class="st">'Accuracy'</span>, <span class="st">'Precision'</span>, <span class="st">'Recall'</span>, <span class="st">'Net_Benefit'</span>]].<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb7-128"><a href=""></a></span>
<span id="cb7-129"><a href=""></a><span class="co"># Find optimal threshold</span></span>
<span id="cb7-130"><a href=""></a>best_threshold_idx <span class="op">=</span> threshold_df[<span class="st">'Net_Benefit'</span>].idxmax()</span>
<span id="cb7-131"><a href=""></a>best_threshold <span class="op">=</span> threshold_df.loc[best_threshold_idx, <span class="st">'Threshold'</span>]</span>
<span id="cb7-132"><a href=""></a>best_benefit <span class="op">=</span> threshold_df.loc[best_threshold_idx, <span class="st">'Net_Benefit'</span>]</span>
<span id="cb7-133"><a href=""></a></span>
<span id="cb7-134"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Optimal Business Threshold: </span><span class="sc">{</span>best_threshold<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-135"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  Maximum Net Benefit: $</span><span class="sc">{</span>best_benefit<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb7-136"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  Business Strategy: </span><span class="sc">{</span><span class="st">'Conservative (high precision)'</span> <span class="cf">if</span> best_threshold <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">else</span> <span class="st">'Aggressive (high recall)'</span> <span class="cf">if</span> best_threshold <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="cf">else</span> <span class="st">'Balanced'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-137"><a href=""></a></span>
<span id="cb7-138"><a href=""></a><span class="co"># Comprehensive visualization</span></span>
<span id="cb7-139"><a href=""></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb7-140"><a href=""></a></span>
<span id="cb7-141"><a href=""></a><span class="co"># 1. Confusion Matrix Heatmap</span></span>
<span id="cb7-142"><a href=""></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb7-143"><a href=""></a>cm_display <span class="op">=</span> confusion_matrix(y_test, y_pred_class)</span>
<span id="cb7-144"><a href=""></a>im <span class="op">=</span> ax1.imshow(cm_display, cmap<span class="op">=</span><span class="st">'Blues'</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb7-145"><a href=""></a></span>
<span id="cb7-146"><a href=""></a><span class="co"># Add text annotations</span></span>
<span id="cb7-147"><a href=""></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb7-148"><a href=""></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb7-149"><a href=""></a>        text <span class="op">=</span> ax1.text(j, i, cm_display[i, j], ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb7-150"><a href=""></a>                       fontsize<span class="op">=</span><span class="dv">20</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-151"><a href=""></a></span>
<span id="cb7-152"><a href=""></a>ax1.set_xticks([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb7-153"><a href=""></a>ax1.set_yticks([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb7-154"><a href=""></a>ax1.set_xticklabels([<span class="st">'No Purchase'</span>, <span class="st">'Purchase'</span>])</span>
<span id="cb7-155"><a href=""></a>ax1.set_yticklabels([<span class="st">'No Purchase'</span>, <span class="st">'Purchase'</span>])</span>
<span id="cb7-156"><a href=""></a>ax1.set_xlabel(<span class="st">'Predicted'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-157"><a href=""></a>ax1.set_ylabel(<span class="st">'Actual'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-158"><a href=""></a>ax1.set_title(<span class="st">'Confusion Matrix'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-159"><a href=""></a></span>
<span id="cb7-160"><a href=""></a><span class="co"># 2. Metrics comparison by threshold</span></span>
<span id="cb7-161"><a href=""></a>ax2 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb7-162"><a href=""></a>ax2.plot(threshold_df[<span class="st">'Threshold'</span>], threshold_df[<span class="st">'Accuracy'</span>], marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Accuracy'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-163"><a href=""></a>ax2.plot(threshold_df[<span class="st">'Threshold'</span>], threshold_df[<span class="st">'Precision'</span>], marker<span class="op">=</span><span class="st">'s'</span>, label<span class="op">=</span><span class="st">'Precision'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-164"><a href=""></a>ax2.plot(threshold_df[<span class="st">'Threshold'</span>], threshold_df[<span class="st">'Recall'</span>], marker<span class="op">=</span><span class="st">'^'</span>, label<span class="op">=</span><span class="st">'Recall'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-165"><a href=""></a></span>
<span id="cb7-166"><a href=""></a>ax2.set_xlabel(<span class="st">'Classification Threshold'</span>)</span>
<span id="cb7-167"><a href=""></a>ax2.set_ylabel(<span class="st">'Metric Value'</span>)</span>
<span id="cb7-168"><a href=""></a>ax2.set_title(<span class="st">'Metrics vs Threshold'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-169"><a href=""></a>ax2.legend()</span>
<span id="cb7-170"><a href=""></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb7-171"><a href=""></a>ax2.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb7-172"><a href=""></a></span>
<span id="cb7-173"><a href=""></a><span class="co"># 3. Business benefit by threshold</span></span>
<span id="cb7-174"><a href=""></a>ax3 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb7-175"><a href=""></a>ax3.bar(threshold_df[<span class="st">'Threshold'</span>].astype(<span class="bu">str</span>), threshold_df[<span class="st">'Net_Benefit'</span>], </span>
<span id="cb7-176"><a href=""></a>        color<span class="op">=</span>[<span class="st">'red'</span> <span class="cf">if</span> x <span class="op">&lt;</span> best_benefit <span class="cf">else</span> <span class="st">'green'</span> <span class="cf">for</span> x <span class="kw">in</span> threshold_df[<span class="st">'Net_Benefit'</span>]], alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb7-177"><a href=""></a></span>
<span id="cb7-178"><a href=""></a><span class="co"># Add value labels</span></span>
<span id="cb7-179"><a href=""></a><span class="cf">for</span> i, value <span class="kw">in</span> <span class="bu">enumerate</span>(threshold_df[<span class="st">'Net_Benefit'</span>]):</span>
<span id="cb7-180"><a href=""></a>    ax3.text(i, value <span class="op">+</span> <span class="dv">100</span>, <span class="ss">f'$</span><span class="sc">{</span>value<span class="sc">:,.0f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-181"><a href=""></a></span>
<span id="cb7-182"><a href=""></a>ax3.set_xlabel(<span class="st">'Classification Threshold'</span>)</span>
<span id="cb7-183"><a href=""></a>ax3.set_ylabel(<span class="st">'Net Business Benefit ($)'</span>)</span>
<span id="cb7-184"><a href=""></a>ax3.set_title(<span class="st">'Business Impact by Threshold'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-185"><a href=""></a>ax3.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb7-186"><a href=""></a></span>
<span id="cb7-187"><a href=""></a><span class="co"># 4. Classification report visualization</span></span>
<span id="cb7-188"><a href=""></a>ax4 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb7-189"><a href=""></a></span>
<span id="cb7-190"><a href=""></a><span class="co"># Detailed classification report</span></span>
<span id="cb7-191"><a href=""></a>report <span class="op">=</span> classification_report(y_test, y_pred_class, output_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-192"><a href=""></a>classes <span class="op">=</span> [<span class="st">'No Purchase'</span>, <span class="st">'Purchase'</span>]</span>
<span id="cb7-193"><a href=""></a>metrics <span class="op">=</span> [<span class="st">'precision'</span>, <span class="st">'recall'</span>, <span class="st">'f1-score'</span>]</span>
<span id="cb7-194"><a href=""></a></span>
<span id="cb7-195"><a href=""></a>metric_values <span class="op">=</span> np.array([[report[<span class="st">'0'</span>][<span class="st">'precision'</span>], report[<span class="st">'0'</span>][<span class="st">'recall'</span>], report[<span class="st">'0'</span>][<span class="st">'f1-score'</span>]],</span>
<span id="cb7-196"><a href=""></a>                         [report[<span class="st">'1'</span>][<span class="st">'precision'</span>], report[<span class="st">'1'</span>][<span class="st">'recall'</span>], report[<span class="st">'1'</span>][<span class="st">'f1-score'</span>]]])</span>
<span id="cb7-197"><a href=""></a></span>
<span id="cb7-198"><a href=""></a>im <span class="op">=</span> ax4.imshow(metric_values, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, aspect<span class="op">=</span><span class="st">'auto'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-199"><a href=""></a></span>
<span id="cb7-200"><a href=""></a><span class="co"># Add text annotations</span></span>
<span id="cb7-201"><a href=""></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb7-202"><a href=""></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb7-203"><a href=""></a>        text <span class="op">=</span> ax4.text(j, i, <span class="ss">f'</span><span class="sc">{</span>metric_values[i, j]<span class="sc">:.3f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb7-204"><a href=""></a>                       fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-205"><a href=""></a></span>
<span id="cb7-206"><a href=""></a>ax4.set_xticks(<span class="bu">range</span>(<span class="dv">3</span>))</span>
<span id="cb7-207"><a href=""></a>ax4.set_yticks(<span class="bu">range</span>(<span class="dv">2</span>))</span>
<span id="cb7-208"><a href=""></a>ax4.set_xticklabels(metrics)</span>
<span id="cb7-209"><a href=""></a>ax4.set_yticklabels(classes)</span>
<span id="cb7-210"><a href=""></a>ax4.set_title(<span class="st">'Classification Report Heatmap'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-211"><a href=""></a></span>
<span id="cb7-212"><a href=""></a><span class="co"># Add colorbar</span></span>
<span id="cb7-213"><a href=""></a>cbar <span class="op">=</span> plt.colorbar(im, ax<span class="op">=</span>ax4, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb7-214"><a href=""></a>cbar.set_label(<span class="st">'Metric Value'</span>, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb7-215"><a href=""></a></span>
<span id="cb7-216"><a href=""></a>plt.tight_layout()</span>
<span id="cb7-217"><a href=""></a>plt.show()</span>
<span id="cb7-218"><a href=""></a></span>
<span id="cb7-219"><a href=""></a><span class="co"># Final recommendations</span></span>
<span id="cb7-220"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">MODEL DEPLOYMENT RECOMMENDATIONS:"</span>)</span>
<span id="cb7-221"><a href=""></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb7-222"><a href=""></a></span>
<span id="cb7-223"><a href=""></a><span class="cf">if</span> f1 <span class="op">&gt;</span> <span class="fl">0.7</span>:</span>
<span id="cb7-224"><a href=""></a>    model_quality <span class="op">=</span> <span class="st">"Excellent"</span></span>
<span id="cb7-225"><a href=""></a><span class="cf">elif</span> f1 <span class="op">&gt;</span> <span class="fl">0.6</span>:</span>
<span id="cb7-226"><a href=""></a>    model_quality <span class="op">=</span> <span class="st">"Good"</span></span>
<span id="cb7-227"><a href=""></a><span class="cf">elif</span> f1 <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb7-228"><a href=""></a>    model_quality <span class="op">=</span> <span class="st">"Fair"</span></span>
<span id="cb7-229"><a href=""></a><span class="cf">else</span>:</span>
<span id="cb7-230"><a href=""></a>    model_quality <span class="op">=</span> <span class="st">"Poor"</span></span>
<span id="cb7-231"><a href=""></a></span>
<span id="cb7-232"><a href=""></a><span class="bu">print</span>(<span class="ss">f"Model Quality: </span><span class="sc">{</span>model_quality<span class="sc">}</span><span class="ss"> (F1-Score: </span><span class="sc">{</span>f1<span class="sc">:.3f}</span><span class="ss">)"</span>)</span>
<span id="cb7-233"><a href=""></a></span>
<span id="cb7-234"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Business Strategy:"</span>)</span>
<span id="cb7-235"><a href=""></a><span class="cf">if</span> precision <span class="op">&gt;</span> recall:</span>
<span id="cb7-236"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  • Conservative approach: High precision, lower recall"</span>)</span>
<span id="cb7-237"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  • Focus on likely buyers to minimize wasted marketing spend"</span>)</span>
<span id="cb7-238"><a href=""></a><span class="cf">elif</span> recall <span class="op">&gt;</span> precision:</span>
<span id="cb7-239"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  • Aggressive approach: High recall, lower precision"</span>)</span>
<span id="cb7-240"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  • Cast wider net to capture more potential customers"</span>)</span>
<span id="cb7-241"><a href=""></a><span class="cf">else</span>:</span>
<span id="cb7-242"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  • Balanced approach: Similar precision and recall"</span>)</span>
<span id="cb7-243"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"  • Good balance between targeting efficiency and coverage"</span>)</span>
<span id="cb7-244"><a href=""></a></span>
<span id="cb7-245"><a href=""></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Monitoring Recommendations:"</span>)</span>
<span id="cb7-246"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Track actual vs predicted purchase rates monthly"</span>)</span>
<span id="cb7-247"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Monitor threshold performance based on business KPIs"</span>)</span>
<span id="cb7-248"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • Retrain model quarterly with new customer data"</span>)</span>
<span id="cb7-249"><a href=""></a><span class="bu">print</span>(<span class="ss">f"  • A/B test different thresholds with small customer segments"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>COMPREHENSIVE CLASSIFICATION EVALUATION
=============================================
CONFUSION MATRIX ANALYSIS:
==============================
Confusion Matrix:
                Predicted
Actual    No Purchase  Purchase
No Purchase      0         6
Purchase         0       119

Confusion Matrix Components:
  True Negatives (TN):  0 - Correctly predicted no purchase
  False Positives (FP): 6 - Incorrectly predicted purchase
  False Negatives (FN): 0 - Missed actual purchases
  True Positives (TP):  119 - Correctly predicted purchases

CLASSIFICATION METRICS:
=========================
Accuracy:  0.952 = (TP + TN) / Total = (119 + 0) / 125
Precision: 0.952 = TP / (TP + FP) = 119 / (119 + 6)
Recall:    1.000 = TP / (TP + FN) = 119 / (119 + 0)
F1-Score:  0.975 = 2 × (Precision × Recall) / (Precision + Recall)

BUSINESS INTERPRETATION:
============================
Accuracy (95.2%):
  • Overall correctness of predictions
  • 119 out of 125 customers correctly classified

Precision (95.2%):
  • Of customers predicted to purchase, 95.2% actually did
  • Lower precision = more wasted marketing spend on unlikely buyers
  • Cost of false positives: unnecessary marketing costs

Recall (100.0%):
  • Of customers who actually purchased, 100.0% were identified
  • Lower recall = missed sales opportunities
  • Cost of false negatives: lost revenue from missed customers

F1-Score (97.5%):
  • Balanced measure when both precision and recall matter
  • Harmonic mean emphasizes lower values

BUSINESS SCENARIO ANALYSIS:
===================================
Business Impact Analysis (assuming $150 avg purchase, $25 marketing cost):
  True Positives:  $14,875 profit (119 successful campaigns)
  False Positives: $150 wasted spend (6 failed campaigns)
  False Negatives: $0 missed revenue (0 lost opportunities)
  True Negatives:  $0 saved costs (0 correctly avoided)

  Net Business Benefit: $14,725

THRESHOLD ANALYSIS:
=========================
Threshold Comparison:
   Threshold  Accuracy  Precision  Recall  Net_Benefit
0        0.3     0.952      0.952     1.0        14725
1        0.5     0.952      0.952     1.0        14725
2        0.7     0.968      0.967     1.0        14775

Optimal Business Threshold: 0.7
  Maximum Net Benefit: $14,775
  Business Strategy: Conservative (high precision)</code></pre>
</div>

<div class="cell-output cell-output-stdout">
<pre><code>
MODEL DEPLOYMENT RECOMMENDATIONS:
========================================
Model Quality: Excellent (F1-Score: 0.975)

Business Strategy:
  • Aggressive approach: High recall, lower precision
  • Cast wider net to capture more potential customers

Monitoring Recommendations:
  • Track actual vs predicted purchase rates monthly
  • Monitor threshold performance based on business KPIs
  • Retrain model quarterly with new customer data
  • A/B test different thresholds with small customer segments</code></pre>
</div>
</div>
<img data-src="Week12-lecture-slides_files/figure-revealjs/cell-4-output-2.png" class="r-stretch"></section>
<section class="slide level2">

</section></section>
<section>
<section id="key-takeaways" class="title-slide slide level1 smaller center">
<h1>Key Takeaways</h1>

</section>
<section id="what-youve-mastered-this-week" class="slide level2 scrollable">
<h2>What You’ve Mastered This Week</h2>
<ol type="1">
<li class="fragment"><strong>Classification vs Regression</strong>: Binary outcomes require different modeling approaches</li>
<li class="fragment"><strong>Sigmoid Function</strong>: Maps any real number to valid probabilities (0-1)</li>
<li class="fragment"><strong>Logistic Regression</strong>: Linear model in log-odds space, non-linear in probability space</li>
<li class="fragment"><strong>Odds Ratios</strong>: Business-interpretable coefficients for decision making</li>
<li class="fragment"><strong>Confusion Matrix</strong>: Complete picture of classification performance</li>
<li class="fragment"><strong>Evaluation Metrics</strong>: Accuracy, Precision, Recall, F1-score for different business priorities</li>
<li class="fragment"><strong>Threshold Optimization</strong>: Balance precision vs recall based on business costs</li>
</ol>
<div class="fragment">
<h3 id="next-week-preview">Next Week Preview</h3>
<p>We’ll explore <strong>Comprehensive Review</strong> - integrating all concepts for advanced business analytics mastery!</p>
</div>
</section>
<section id="classification-best-practices" class="slide level2 smaller">
<h2>Classification Best Practices</h2>
<h3 id="professional-guidelines-for-business-classification">Professional Guidelines for Business Classification</h3>
<ul>
<li class="fragment"><strong>Understand the Business Problem</strong>: What are the costs of false positives vs false negatives?</li>
<li class="fragment"><strong>Check Class Balance</strong>: Imbalanced classes may require special handling</li>
<li class="fragment"><strong>Choose Appropriate Metrics</strong>: Accuracy isn’t always the best measure</li>
<li class="fragment"><strong>Optimize Business Objectives</strong>: Use threshold analysis for maximum business value</li>
<li class="fragment"><strong>Validate Thoroughly</strong>: Use train-test split and cross-validation</li>
<li class="fragment"><strong>Interpret Coefficients</strong>: Odds ratios provide clear business insights</li>
<li class="fragment"><strong>Monitor Performance</strong>: Track metrics over time as business conditions change</li>
<li class="fragment"><strong>Document Assumptions</strong>: Model limitations and decision rationale</li>
</ul>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>Logistic Regression provides the foundation for all binary classification - master these concepts for advanced machine learning success!</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="questions" class="title-slide slide level1 center">
<h1>Questions?</h1>

</section>
<section id="resources-for-this-week" class="slide level2">
<h2>Resources for This Week</h2>
<ul>
<li><strong>Banknote Authentication Project</strong>: Binary classification implementation</li>
<li><strong>Customer Churn Analysis</strong>: Real-world logistic regression application</li>
<li><strong>Practice Problems</strong>: Classification modeling and evaluation exercises</li>
<li><strong>Office Hours</strong>: Available for help with classification concepts</li>
</ul>
<h3 id="coming-up">Coming Up</h3>
<ul>
<li><strong>Week 13</strong>: Comprehensive Review and Advanced Model Evaluation</li>
<li><strong>Final Project</strong>: Integrating all course concepts</li>
<li><strong>Course Synthesis</strong>: From basic Python to advanced business analytics</li>
</ul>
<h3 id="contact-information">Contact Information</h3>
<ul>
<li>Email: smith515@usf.edu</li>
<li>Office Hours: See Canvas for current schedule</li>
</ul>

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>ISM4641 Python for Business ©️2025 Tim Smith</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="Week12-lecture-slides_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="Week12-lecture-slides_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="Week12-lecture-slides_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="Week12-lecture-slides_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="Week12-lecture-slides_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="Week12-lecture-slides_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="Week12-lecture-slides_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="Week12-lecture-slides_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="Week12-lecture-slides_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="Week12-lecture-slides_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="Week12-lecture-slides_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
    scrollable: true,
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>